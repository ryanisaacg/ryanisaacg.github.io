<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> A Quicksilver Chanukah, Day 5: Golem :: ryan.isaac.g </title>

    <meta property="og:title" content="A Quicksilver Chanukah, Day 5: Golem :: ryan.isaac.g">
    <meta name="description" content="golem is a mostly-safe graphics API that targets OpenGL 3.2 and WebGL 1 that helps make writing GL less painful.">
    <meta property="og:description" content="golem is a mostly-safe graphics API that targets OpenGL 3.2 and WebGL 1 that helps make writing GL less painful.">
    <!-- Keep synced with link color in site.scss -->
    <meta name="theme-color" content="#4c4edd">
    
    
    <link rel="alternate" type="application/rss+xml" title="Ryan's Blog" href="/rss.xml">
  <link rel="stylesheet" href="/_astro/_...slug_.bb52763f.css" />
<link rel="stylesheet" href="/_astro/_...slug_.75727b75.css" /></head>
  <body>
    
    <header class="astro-3EF6KSR2">
    <div class="page-header astro-3EF6KSR2">
        <strong class="astro-3EF6KSR2">ryan.isaac.g</strong>
        <div class="header-links astro-3EF6KSR2">
            <a href="/" class="astro-3EF6KSR2">/home</a>
        </div>
    </div>
    <h1>A Quicksilver Chanukah, Day 5: Golem</h1>
        <small>26 Dec  2019</small>
    
</header>
    <article>
        <p><code>golem</code> is a mostly-safe graphics API that targets OpenGL 3.2 and WebGL 1 that helps make writing GL less painful.</p>
<h2 id="why-golem-and-not-x">Why <code>golem</code> and not X</h2>
<p>If you’re just interested in what <code>golem</code> is and how it works, feel free to skip this section!</p>
<p>The previous three days I’ve introduced new crates that mostly stood on their own. I’m not aware of any fleshed-out alternatives, so creating those libraries myself doesn’t require much explanation. <code>golem</code>, however, is a different story: there aren’t exactly a shortage of Rust graphics libraries. There are a variety of reasons as to why none of them fit Quicksilver’s needs, most of which revolve around support for older hardware or older APIs. For brevity, I’d recommend you check out <a href="https://wiki.alopex.li/AGuideToRustGraphicsLibraries2019">icefox’s guide to the existing graphics options</a>.</p>
<p>I have a test device that I think is a good benchmark for something Quicksilver-powered games should be able to target, and it doesn’t support Vulkan. This eliminates <code>ash</code> and <code>vulkano</code> straight off the bat, and <code>gfx-hal</code> as well. <code>ash</code> and <code>vulkano</code> target Vulkan directly, and <code>gfx-hal</code>’s OpenGL backend is not currently reliable enough (though I hope to see that improve!)</p>
<p>I also want to be able to support WebGL 1, but WebGL 1 is not a very modern version of OpenGL. This makes it, for good reaon, unattractive to other libraries (like <code>luminance</code>, which is targeting WebGL 2 in its upcoming web support). However, WebGL 2’s <a href="https://caniuse.com/#feat=webgl2">market share</a> still hovers at around 75%, which isn’t ideal; notably missing from WebGL 2 support are the current verisons of Edge, Safari, and iOS Safari. Quicksilver recently transitioned to using WebGL 1 for better platform support, and I didn’t want to regress by requiring a high version. This rules out <code>luminance</code>, and presumably <code>glium</code> (which has no current development towards web support as far as I’m aware.)</p>
<p>With just those two constraints I’m out of options, so I decided to write <code>golem</code>.</p>
<h2 id="mostly-safe">Mostly-Safe?</h2>
<p>Where possible, <code>golem</code> handles for you the complex state machine of OpenGL. In other places, it prevents you from using resources that haven’t been properly set-up. In these cases, <code>golem</code> is safe with low-overhead, removing footguns from OpenGL without slowing your code down. In others, more overhead would be required to keep the API free of <code>unsafe</code>. Currently only two functions are marked as <code>unsafe</code> in <code>golem</code>’s public API, but they are the only functions that draw things to the screen! This means using <code>unsafe</code> code as a consumer of <code>golem</code> is unavoidable, hence “mostly-safe.”</p>
<h2 id="a-code-snippet">A Code Snippet</h2>
<p>Hopefully if you’re familiar with graphics APIs, this code snippet to draw a triangle to the screen will look a little familiar. If not, the comments should help you follow along!</p>
<pre is:raw="" class="astro-code" style="background-color: var(--astro-code-color-background); overflow-x: auto;"><code><span class="line"><span style="color: var(--astro-code-token-keyword)">use</span><span style="color: var(--astro-code-color-text)"> blinds</span><span style="color: var(--astro-code-token-keyword)">::*</span><span style="color: var(--astro-code-color-text)">;</span></span>
<span class="line"><span style="color: var(--astro-code-token-keyword)">use</span><span style="color: var(--astro-code-color-text)"> golem</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-color-text)">{</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-function)">Attribute</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-function)">AttributeType</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-function)">Context</span><span style="color: var(--astro-code-color-text)">,</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-function)">Dimension</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-color-text)">{</span><span style="color: var(--astro-code-token-function)">D2</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-function)">D4</span><span style="color: var(--astro-code-color-text)">},</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-function)">ElementBuffer</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-function)">GeometryMode</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-function)">GolemError</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-function)">ShaderDescription</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-function)">ShaderProgram</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-function)">VertexBuffer</span><span style="color: var(--astro-code-color-text)">,</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">// The application loop, powered by the blinds crate</span></span>
<span class="line"><span style="color: var(--astro-code-token-keyword)">async</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-keyword)">fn</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-function)">app</span><span style="color: var(--astro-code-color-text)">(</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    window</span><span style="color: var(--astro-code-token-keyword)">:</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-function)">Window</span><span style="color: var(--astro-code-color-text)">,</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    ctx</span><span style="color: var(--astro-code-token-keyword)">:</span><span style="color: var(--astro-code-color-text)"> glow</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">Context</span><span style="color: var(--astro-code-color-text)">,</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-keyword)">mut</span><span style="color: var(--astro-code-color-text)"> events</span><span style="color: var(--astro-code-token-keyword)">:</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-function)">EventStream</span><span style="color: var(--astro-code-color-text)">,</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">) </span><span style="color: var(--astro-code-token-keyword)">-></span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-function)">Result</span><span style="color: var(--astro-code-color-text)">&#x3C;(), </span><span style="color: var(--astro-code-token-function)">GolemError</span><span style="color: var(--astro-code-color-text)">> {</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // Create a context from 'glow', GL On Whatever</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-keyword)">let</span><span style="color: var(--astro-code-color-text)"> ctx </span><span style="color: var(--astro-code-token-keyword)">=</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-keyword)">&#x26;</span><span style="color: var(--astro-code-token-function)">Context</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">from_glow</span><span style="color: var(--astro-code-color-text)">(ctx)</span><span style="color: var(--astro-code-token-keyword)">?</span><span style="color: var(--astro-code-color-text)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    #[rustfmt</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-color-text)">skip]</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // This is the data that represents the triangle</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // It's arranged how it will be passed to the GPU: each position represented as two f32 values,</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // followed by each color represented as 4 f32 values. The positions are on a scale from -1.0</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // to 1.0, which represents the viewport in OpenGL. The colors are represented as R, G, B, A,</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // on a scale from 0.0 to 1.0</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-keyword)">let</span><span style="color: var(--astro-code-color-text)"> vertices </span><span style="color: var(--astro-code-token-keyword)">=</span><span style="color: var(--astro-code-color-text)"> [</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">        // Position         Color</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">        </span><span style="color: var(--astro-code-token-keyword)">-</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">5</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-keyword)">-</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">5</span><span style="color: var(--astro-code-color-text)">,         </span><span style="color: var(--astro-code-token-constant)">1</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-constant)">1</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">,</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">        </span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">5</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-keyword)">-</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">5</span><span style="color: var(--astro-code-color-text)">,          </span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-constant)">1</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-constant)">1</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">,</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">        </span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">5</span><span style="color: var(--astro-code-color-text)">,           </span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-constant)">1</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-constant)">1</span><span style="color: var(--astro-code-token-punctuation)">.</span><span style="color: var(--astro-code-token-constant)">0</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    ];</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // This is the data that indicates how to draw the vertices</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // For a simple example of one triangle, we don't gain much from this. Any order of these three</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // points will give us the same triangle. However, if we add more points (to draw a square, for</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // example), then we can write each point once while using it in multiple triangles.</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-keyword)">let</span><span style="color: var(--astro-code-color-text)"> indices </span><span style="color: var(--astro-code-token-keyword)">=</span><span style="color: var(--astro-code-color-text)"> [</span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-constant)">1</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-constant)">2</span><span style="color: var(--astro-code-color-text)">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // Here we create the ShaderProgram, which is some code that runs on the GPU. It determines how</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // to turn our vertex data into an actual vertex that GL understands, and how to color each</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // 'fragment' (essentially a pixel). These are each their own little program, where the</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // information from the vertex shader is fed into the fragment shader.</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // For the purposes of making sure the shaders match, and for ensuring compatibility on desktop</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // and web, the inputs are represented as data structures and then converted to shader</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // declarations at runtime.</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // The input to the shader program is fed to the vertex_input, so your vertex data's format</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // needs to match what you define in vertex_input</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-keyword)">let</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-keyword)">mut</span><span style="color: var(--astro-code-color-text)"> shader </span><span style="color: var(--astro-code-token-keyword)">=</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-function)">ShaderProgram</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">new</span><span style="color: var(--astro-code-color-text)">(</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">        ctx,</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">        </span><span style="color: var(--astro-code-token-function)">ShaderDescription</span><span style="color: var(--astro-code-color-text)"> {</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">            // Take in to the shader a position (as a vector with 2 components) and a color (as a</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">            // vector with 4 components). This is the same format as 'vertices' above</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">            vertex_input</span><span style="color: var(--astro-code-token-keyword)">:</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-keyword)">&#x26;</span><span style="color: var(--astro-code-color-text)">[</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">                </span><span style="color: var(--astro-code-token-function)">Attribute</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">new</span><span style="color: var(--astro-code-color-text)">(</span><span style="color: var(--astro-code-token-string-expression)">"vert_position"</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-function)">AttributeType</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">Vector</span><span style="color: var(--astro-code-color-text)">(</span><span style="color: var(--astro-code-token-function)">D2</span><span style="color: var(--astro-code-color-text)">)),</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">                </span><span style="color: var(--astro-code-token-function)">Attribute</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">new</span><span style="color: var(--astro-code-color-text)">(</span><span style="color: var(--astro-code-token-string-expression)">"vert_color"</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-function)">AttributeType</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">Vector</span><span style="color: var(--astro-code-color-text)">(</span><span style="color: var(--astro-code-token-function)">D4</span><span style="color: var(--astro-code-color-text)">)),</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">            ],</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">            // Pass to the fragment shader the color</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">            // OpenGL will actually smoothly interpolate between different vertex values for us, so</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">            // a red vertex and a blue vertex will have a gradient between them</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">            fragment_input</span><span style="color: var(--astro-code-token-keyword)">:</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-keyword)">&#x26;</span><span style="color: var(--astro-code-color-text)">[</span><span style="color: var(--astro-code-token-function)">Attribute</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">new</span><span style="color: var(--astro-code-color-text)">(</span><span style="color: var(--astro-code-token-string-expression)">"frag_color"</span><span style="color: var(--astro-code-color-text)">, </span><span style="color: var(--astro-code-token-function)">AttributeType</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">Vector</span><span style="color: var(--astro-code-color-text)">(</span><span style="color: var(--astro-code-token-function)">D4</span><span style="color: var(--astro-code-color-text)">))],</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">            // Uniforms represent a value that's the same for the entire shader; we don't need any</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">            // here. If you're rendering images or applying transformations to your entire draw</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">            // call, use uniforms!</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">            uniforms</span><span style="color: var(--astro-code-token-keyword)">:</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-keyword)">&#x26;</span><span style="color: var(--astro-code-color-text)">[],</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">            // A program written in GLSL that uses the inputs and outputs defined above</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">            // There's also a hard-coded output called gl_Position</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">            vertex_shader</span><span style="color: var(--astro-code-token-keyword)">:</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-string-expression)">r#" void main() {</span></span>
<span class="line"><span style="color: var(--astro-code-token-string-expression)">            gl_Position = vec4(vert_position, 0, 1);</span></span>
<span class="line"><span style="color: var(--astro-code-token-string-expression)">            frag_color = vert_color;</span></span>
<span class="line"><span style="color: var(--astro-code-token-string-expression)">        }"#</span><span style="color: var(--astro-code-color-text)">,</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">            // The fragment shader has a hard-coded output: gl_FragColor</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">            fragment_shader</span><span style="color: var(--astro-code-token-keyword)">:</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-string-expression)">r#" void main() {</span></span>
<span class="line"><span style="color: var(--astro-code-token-string-expression)">            gl_FragColor = frag_color;</span></span>
<span class="line"><span style="color: var(--astro-code-token-string-expression)">        }"#</span><span style="color: var(--astro-code-color-text)">,</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">        },</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    )</span><span style="color: var(--astro-code-token-keyword)">?</span><span style="color: var(--astro-code-color-text)">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // Create buffer objects, which we use to transfer data from the CPU to the GPU</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-keyword)">let</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-keyword)">mut</span><span style="color: var(--astro-code-color-text)"> vb </span><span style="color: var(--astro-code-token-keyword)">=</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-function)">VertexBuffer</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">new</span><span style="color: var(--astro-code-color-text)">(ctx)</span><span style="color: var(--astro-code-token-keyword)">?</span><span style="color: var(--astro-code-color-text)">;</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-keyword)">let</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-keyword)">mut</span><span style="color: var(--astro-code-color-text)"> eb </span><span style="color: var(--astro-code-token-keyword)">=</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-function)">ElementBuffer</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">new</span><span style="color: var(--astro-code-color-text)">(ctx)</span><span style="color: var(--astro-code-token-keyword)">?</span><span style="color: var(--astro-code-color-text)">;</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // Set the data of the buffer to be our vertices and indices from earlier</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    vb</span><span style="color: var(--astro-code-token-keyword)">.</span><span style="color: var(--astro-code-token-function)">set_data</span><span style="color: var(--astro-code-color-text)">(</span><span style="color: var(--astro-code-token-keyword)">&#x26;</span><span style="color: var(--astro-code-color-text)">vertices);</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    eb</span><span style="color: var(--astro-code-token-keyword)">.</span><span style="color: var(--astro-code-token-function)">set_data</span><span style="color: var(--astro-code-color-text)">(</span><span style="color: var(--astro-code-token-keyword)">&#x26;</span><span style="color: var(--astro-code-color-text)">indices);</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // Prepare the shader for operations: shaders will raise errors if you forget to bind them</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    shader</span><span style="color: var(--astro-code-token-keyword)">.</span><span style="color: var(--astro-code-token-function)">bind</span><span style="color: var(--astro-code-color-text)">();</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // Clear the screen</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    ctx</span><span style="color: var(--astro-code-token-keyword)">.</span><span style="color: var(--astro-code-token-function)">clear</span><span style="color: var(--astro-code-color-text)">();</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-keyword)">unsafe</span><span style="color: var(--astro-code-color-text)"> {</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">        // Using our buffers, draw our triangle</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">        // We could also interpert our indices as Lines or a variety of other shape options:</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">        // nothing binds us to necessarily using Triangles, even though they're the most common</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">        // shape in graphics</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">        shader</span><span style="color: var(--astro-code-token-keyword)">.</span><span style="color: var(--astro-code-token-function)">draw</span><span style="color: var(--astro-code-color-text)">(</span><span style="color: var(--astro-code-token-keyword)">&#x26;</span><span style="color: var(--astro-code-color-text)">vb, </span><span style="color: var(--astro-code-token-keyword)">&#x26;</span><span style="color: var(--astro-code-color-text)">eb, </span><span style="color: var(--astro-code-token-constant)">0</span><span style="color: var(--astro-code-token-keyword)">..</span><span style="color: var(--astro-code-color-text)">indices</span><span style="color: var(--astro-code-token-keyword)">.</span><span style="color: var(--astro-code-token-function)">len</span><span style="color: var(--astro-code-color-text)">(), </span><span style="color: var(--astro-code-token-function)">GeometryMode</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">Triangles</span><span style="color: var(--astro-code-color-text)">)</span><span style="color: var(--astro-code-token-keyword)">?</span><span style="color: var(--astro-code-color-text)">;</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    }</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // Show our data to the window</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    window</span><span style="color: var(--astro-code-token-keyword)">.</span><span style="color: var(--astro-code-token-function)">present</span><span style="color: var(--astro-code-color-text)">();</span></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">    // Keep the window open and responsive until the user exits</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-keyword)">loop</span><span style="color: var(--astro-code-color-text)"> {</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">        events</span><span style="color: var(--astro-code-token-keyword)">.</span><span style="color: var(--astro-code-token-function)">next_event</span><span style="color: var(--astro-code-color-text)">()</span><span style="color: var(--astro-code-token-keyword)">.await</span><span style="color: var(--astro-code-color-text)">;</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    }</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: var(--astro-code-token-comment)">// Run our application!</span></span>
<span class="line"><span style="color: var(--astro-code-token-keyword)">fn</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-function)">main</span><span style="color: var(--astro-code-color-text)">() {</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    </span><span style="color: var(--astro-code-token-function)">run_gl</span><span style="color: var(--astro-code-color-text)">(</span><span style="color: var(--astro-code-token-function)">Settings</span><span style="color: var(--astro-code-token-keyword)">::</span><span style="color: var(--astro-code-token-function)">default</span><span style="color: var(--astro-code-color-text)">(), </span><span style="color: var(--astro-code-token-keyword)">|</span><span style="color: var(--astro-code-color-text)">window, gfx, events</span><span style="color: var(--astro-code-token-keyword)">|</span><span style="color: var(--astro-code-color-text)"> {</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">        </span><span style="color: var(--astro-code-token-keyword)">async</span><span style="color: var(--astro-code-color-text)"> </span><span style="color: var(--astro-code-token-keyword)">move</span><span style="color: var(--astro-code-color-text)"> { </span><span style="color: var(--astro-code-token-function)">app</span><span style="color: var(--astro-code-color-text)">(window, gfx, events)</span><span style="color: var(--astro-code-token-keyword)">.await.</span><span style="color: var(--astro-code-token-function)">unwrap</span><span style="color: var(--astro-code-color-text)">() }</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">    });</span></span>
<span class="line"><span style="color: var(--astro-code-color-text)">}</span></span></code></pre>
<p>(This is also an example of <a href="../quicksilver-chanukah-2019-day-4">yesterday’s <code>blinds</code></a> and its OpenGL support.)</p>
<h2 id="further-development">Further Development</h2>
<p><code>golem</code> is not intended to be a fully-featured wrapper around all of OpenGL. It’s intended to be enough to write fairly complex 2D graphics, or fairly simple 3D graphics. That said, there is a lot that’s missing! Some of it is documented on the <a href="https://github.com/ryanisaacg/golem/issues">issue tracker</a>, but I’m sure that I’ve missed other things. Nearly everything I need for Quicksilver is done, but your use case might be different. Feel free to open an issue discussing a feature addition, or try and experiment with a fork for larger changes.</p>
<p><code>golem</code> is the last new crate to announce, which means tomorrow is about what these crates enable: the new version of Quicksilver.</p>
<ol>
<li><a href="../quicksilver-chanukah-2019">The introduction post</a></li>
<li><a href="../quicksilver-chanukah-2019-day-2"><code>platter</code>: An async file-loading API for desktop and web</a></li>
<li><a href="../quicksilver-chanukah-2019-day-3"><code>gestalt</code>: An API to manage bundling and saving data locally on desktop and web</a></li>
<li><a href="../quicksilver-chanukah-2019-day-4"><code>blinds</code>: An easy-to-use async wrapper of <code>winit</code></a></li>
<li>This post!</li>
<li><a href="../quicksilver-chanukah-2019-day-6">Changes to the Quicksilver application lifecycle</a></li>
<li><a href="../quicksilver-chanukah-2019-day-7">Changes to the Quicksilver graphics API</a></li>
<li><a href="../quicksilver-chanukah-2019-day-8">An overview of the work on web support this year</a></li>
</ol>
    </article>

  </body></html>