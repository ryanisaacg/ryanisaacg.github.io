<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:base="https://ryanisaacg.com">
  <title>Ryan&#39;s Blog</title>
  <subtitle></subtitle>
  <link href="https://ryanisaacg.com/rss.xml" rel="self"/>
  <link href="https://ryanisaacg.com"/>
  <updated>2025-01-11T16:41:20Z</updated>
  <id>https://ryanisaacg.com</id>
  <author>
    <name>Ryan</name>
  </author>
  
  
  
    <entry>
      <title>Quick Advice to New Rustaceans</title>
      <link href="https://ryanisaacg.com/posts/new-rustacean-advice.html"/>
      <updated>2025-01-11T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/new-rustacean-advice.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Let’s say you’re new to Rust. Maybe you’ve read &lt;a href=&quot;https://doc.rust-lang.org/book/&quot;&gt;TRPL&lt;/a&gt; and worked through &lt;a href=&quot;https://github.com/rust-lang/rustlings&quot;&gt;Rustlings&lt;/a&gt; or &lt;a href=&quot;https://yarr.fyi/&quot;&gt;YARR&lt;/a&gt;. You can write enough Rust to solve problems, and can fix compiler errors when they crop up. Now you come to a more nebulous question: how do you write &lt;em&gt;good&lt;/em&gt; Rust? And how do you write Rust that won’t require mortal combat with the borrow checker?&lt;/p&gt;
&lt;p&gt;Start by letting go of a no-compromises approach to performance.&lt;/p&gt;
&lt;h2&gt;Don’t Be Afraid to Clone&lt;/h2&gt;
&lt;p&gt;Because Rust makes cloning explicit, I get the feeling that a lot of newcomers find it stressful. How expensive of an operation is a &lt;code&gt;.clone()&lt;/code&gt;? Unfortunately, the answer can range from “very expensive” to “very cheap.” Reference-counted structures like an &lt;code&gt;Arc&lt;/code&gt; or a channel can be cloned very cheaply. Generally strings like usernames, filenames, or paths are small, and therefore cheap. In these cases clone first and think later.&lt;/p&gt;
&lt;p&gt;In cases where you’re uncertain, I would still strongly recommend cloning! You can always profile your code to see if the clones are performance drags, but I promise you it’s unlikely. In most cases choosing more suitable data structures, adding caches, or improving memory locality will all pay bigger dividends than agonizingly avoiding allocation.&lt;/p&gt;
&lt;h2&gt;Don’t Store References&lt;/h2&gt;
&lt;p&gt;The number one way new-to-Rust programmers make their lives harder is to deal with lifetime annotations. I have been writing Rust for a little under ten years; I have &lt;a href=&quot;https://github.com/ryanisaacg/quicksilver&quot;&gt;maintained a game library&lt;/a&gt; and &lt;a href=&quot;https://github.com/ryanisaacg/brick&quot;&gt;written a hobby compiler&lt;/a&gt;. I &lt;em&gt;still&lt;/em&gt; find code that makes heavy use of lifetime annotations confusing. How do you avoid them? Don’t store references in data structures. Instead, clone the values (if they can be cloned cheaply) or use an &lt;code&gt;Arc&lt;/code&gt; or &lt;code&gt;Cow&lt;/code&gt; as appropriate.&lt;/p&gt;
&lt;h2&gt;Use &lt;code&gt;Send&lt;/code&gt; and &lt;code&gt;Sync&lt;/code&gt; containers&lt;/h2&gt;
&lt;p&gt;Technically, &lt;code&gt;Rc&lt;/code&gt; and &lt;code&gt;RefCell&lt;/code&gt; are lighter-weight than &lt;code&gt;Arc&lt;/code&gt; and &lt;code&gt;Mutex&lt;/code&gt;. If you’re 100% sure that a given bit of code will never become concurrent, by all means use them. For example: audio code tends to run in a dedicated thread, so you know that there’s no reason to share that data. In &lt;em&gt;any other case&lt;/em&gt; I strongly recommend going with the &lt;code&gt;Send&lt;/code&gt; and &lt;code&gt;Sync&lt;/code&gt; alternatives instead. You’ll be unlikely to notice the performance cost, and you’ll be grateful to not have to refactor swathes of your program if you want to introduce some kind of parallelism later.&lt;/p&gt;
&lt;h2&gt;(Bonus) Check out the Rust API Guidelines&lt;/h2&gt;
&lt;p&gt;They explain some key heuristics to writing good Rust. Here are the few entries that I think are both most important and least intuitive:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://rust-lang.github.io/api-guidelines/naming.html#ad-hoc-conversions-follow-as_-to_-into_-conventions-c-conv&quot;&gt;How to distinguish &lt;code&gt;as&lt;/code&gt;, &lt;code&gt;to&lt;/code&gt;, and &lt;code&gt;into&lt;/code&gt; conversion methods&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://rust-lang.github.io/api-guidelines/interoperability.html#conversions-use-the-standard-traits-from-asref-asmut-c-conv-traits&quot;&gt;Implement the &lt;code&gt;From&lt;/code&gt; trait, never the &lt;code&gt;Into&lt;/code&gt; trait&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://rust-lang.github.io/api-guidelines/flexibility.html#caller-decides-where-to-copy-and-place-data-c-caller-control&quot;&gt;Don’t take arguments by reference to clone them; let the caller do it&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://rust-lang.github.io/api-guidelines/future-proofing.html&quot;&gt;Take a look at the future-proofing section, if your API has customers you don’t control&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Recurse Center: Weeks 10 - 12</title>
      <link href="https://ryanisaacg.com/posts/recurse-weeks-10-12.html"/>
      <updated>2024-09-25T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/recurse-weeks-10-12.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;As I said in &lt;a href=&quot;https://ryanisaacg.com/posts/recurse-week-9&quot;&gt;week 9&lt;/a&gt;, personal life and my job search were headwinds on the last chunk of my batch. In the last quarter I didn’t have time to write individual week-summary posts, so instead I’ll group them all here.&lt;/p&gt;
&lt;p&gt;Over the last three weeks of my batch, I:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rewrote Brick’s error handling. Instead of dumping the &lt;code&gt;Debug&lt;/code&gt; representation of errors, it now gives the location and error message in a readable format.&lt;/li&gt;
&lt;li&gt;Wrote &lt;a href=&quot;https://github.com/ryanisaacg/vinyl&quot;&gt;a tiny website&lt;/a&gt; to allow folks on my local network to upload music to the household plex server.&lt;/li&gt;
&lt;li&gt;For “half-baked demos”, I &lt;a href=&quot;https://ryanisaacg.com/webrick/&quot;&gt;put Brick in a webpage&lt;/a&gt;. It’s actually pretty simple! I created a tiny Rust crate which provides a wasm export that compiles Brick source to wasm. Then I hooked that up to a text editor and displayed the output in HTML.&lt;/li&gt;
&lt;li&gt;Added support for autocloned refcounts to Brick. This is the first step towards persistent data structure support in the language; more in a forthcoming Brick-specific blogpost.&lt;/li&gt;
&lt;li&gt;Created a Treesitter grammar for Brick. The first-order benefit is that I have syntax highlighting now! Hopefully I can also use this to power other tools, like the language server, in the future.&lt;/li&gt;
&lt;li&gt;Gave a presentation on Brick. The reception was so positive that I’m considering taking the project a little more seriously than I have been (though my first priority is still to have fun).&lt;/li&gt;
&lt;li&gt;Never-graduated! My batch is now over and I’m an RC alum.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Expect to see more RC wrap-up around here: a “return statement” (retrospective post), some projects that I haven’t yet posted about, and some blog drafts I still need to polish. After that post volume will drop off quite a bit, what with the end of my Recurse batch and full-time employment on the horizon.&lt;/p&gt;
</content>
    </entry>
  
  
  
    <entry>
      <title>Recurse Center: Week 9</title>
      <link href="https://ryanisaacg.com/posts/recurse-week-9.html"/>
      <updated>2024-09-03T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/recurse-week-9.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Personal life and my job search continue to slow my RC progress slightly, which I expected for the back half of my batch.&lt;/p&gt;
&lt;p&gt;This week had the second Impossible Stuff Day of my batch. I decided to fix a performance issue with testing &lt;a href=&quot;https://ryanisaacg.com/posts/recurse-week-8&quot;&gt;&lt;code&gt;brick-ld&lt;/code&gt;&lt;/a&gt;, which took the test suite runtime from ~11 seconds to ~0.5 seconds. The optimization is based on &lt;a href=&quot;https://github.com/ryanisaacg/brick/blob/main/brick-ld/tests/wasm_data.rs#L31&quot;&gt;chunking multiple source files into the same binary&lt;/a&gt;, and then running multiple tests off that binary. It turns out overhead from setting up wasmtime instances is the majority of the test time, so anything that reduces that overhead speeds up tests greatly.&lt;/p&gt;
&lt;p&gt;For the rest of the week, I decided to switch gears and learn Go. I did the first few days of Advent of Code 2023, which helped me get an initial grasp on the language. By the second part of Day 5 I felt I was hitting diminishing returns, so I stopped there. Go doesn’t have many fancy features for data structures or iteration, which Advent of Code problems usually focus on. Once you’ve used a slice, a map, and a struct, you’ve really learned all of the language that Advent will help you with imo.&lt;/p&gt;
&lt;p&gt;I also built a &lt;a href=&quot;https://github.com/ryanisaacg/vinyl&quot;&gt;tiny web service in Go&lt;/a&gt; to allow my partner to upload music from their phone to our Plex server. It’s &lt;a href=&quot;https://maggieappleton.com/home-cooked-software&quot;&gt;homecooked&lt;/a&gt;, it’s &lt;a href=&quot;https://handmade.network/manifesto&quot;&gt;handmade&lt;/a&gt;, it’s &lt;a href=&quot;https://gwern.net/doc/technology/2004-03-30-shirky-situatedsoftware.html&quot;&gt;situated&lt;/a&gt;. Which is to say it’s two HTML forms and a single input element, and it is so simple that I didn’t even hit my goal of learning HTMX. I’ll need to find a slightly more complex project for that, I guess.&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Recurse Center: Week 8</title>
      <link href="https://ryanisaacg.com/posts/recurse-week-8.html"/>
      <updated>2024-08-29T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/recurse-week-8.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Personal life got in the way for 2 of the 5 days of Week 8, which is unfortunate but happens. I only had time to focus on one project this week, but it was a chunky one: I wrote a linker for &lt;a href=&quot;https://github.com/ryanisaacg/brick&quot;&gt;Brick&lt;/a&gt;’s toolchain.&lt;/p&gt;
&lt;p&gt;This isn’t my extremely cursed &lt;a href=&quot;https://ryanisaacg.com/posts/wasmtime-dl&quot;&gt;wasmtime-dl project&lt;/a&gt;. It’s a crate that takes multiple WASM modules, resolves any exports that match imports, smooshes them all together, and outputs a single standalone module. This is crucial for Brick’s compilation process, because I need to combine the user’s compiled program with the runtime I wrote in Rust. I rolled my own linker for three reasons:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;I thought it would be fun (it was)&lt;/li&gt;
&lt;li&gt;I wanted to avoid taking a massive C++ dependency&lt;/li&gt;
&lt;li&gt;If I write the code, I know it’s doing exactly what I need and nothing else&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;There are two major alternatives I considered, &lt;a href=&quot;https://github.com/WebAssembly/binaryen?tab=readme-ov-file#tools&quot;&gt;&lt;code&gt;wasm-merge&lt;/code&gt;&lt;/a&gt; or &lt;a href=&quot;https://lld.llvm.org/WebAssembly.html&quot;&gt;&lt;code&gt;wasm-ld&lt;/code&gt;&lt;/a&gt;. The first is part of the &lt;a href=&quot;https://github.com/WebAssembly/binaryen&quot;&gt;binaryen&lt;/a&gt; project, which is a WASM toolkit; the second is a port of &lt;a href=&quot;https://lld.llvm.org/&quot;&gt;&lt;code&gt;lld&lt;/code&gt;&lt;/a&gt;. Taking dependencies on either of these major projects would conflict with goal #2 and #3 above. Keeping my dependency tree purely Rust makes building and running the compiler simpler, especially if I want to build the compiler itself to WASM and embed it in a webpage.&lt;/p&gt;
&lt;p&gt;Avoiding large dependencies decreases the overall complexity of the project; currently the only dependencies I’m taking are Rust ecosystem mainstays (&lt;code&gt;rayon&lt;/code&gt;, &lt;code&gt;anyhow&lt;/code&gt;, &lt;code&gt;thiserror&lt;/code&gt;, &lt;code&gt;serde&lt;/code&gt;) or protocol-specific crates that I &lt;em&gt;could&lt;/em&gt; rewrite myself if necessary (&lt;code&gt;wasm-encoder&lt;/code&gt;, &lt;code&gt;wasmparser&lt;/code&gt;, &lt;code&gt;lsp-server&lt;/code&gt;, &lt;code&gt;lsp-types&lt;/code&gt;)&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/recurse-week-8.html#fn1&quot; id=&quot;fnref1&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;.  If a newcomer wanted to understand the project end-to-end, they would be confronted with around 20,000 lines of Rust. That sounds like a lot, but Binaryen is hundreds of thousands of lines of C++ and LLVM is in the &lt;em&gt;millions&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Also, this is probably minor in the scheme of things for performance, but &lt;code&gt;wasm-merge&lt;/code&gt; and &lt;code&gt;wasm-ld&lt;/code&gt; both work with objects on disk. I wanted to do the linking in-memory before I write out the final binary, for convenience and speed.&lt;/p&gt;
&lt;p&gt;Over the weekend between Weeks 8 and 9 I also hacked on an Obsidian plugin. It was a pretty fun experience, and my web background made it very straightforward. I now have a plugin which allows me to review my diary notes from the past week, which I like to do as part of my journaling practice. You can &lt;a href=&quot;https://github.com/ryanisaacg/obsidian-diary-review&quot;&gt;check it out on Github&lt;/a&gt;, but it’s not documented or configurable in the slightest. I might come back and clean it up at some point, but no promises - it’s already doing everything I need.&lt;/p&gt;
&lt;hr class=&quot;footnotes-sep&quot; /&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn1&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;Technically I also depend on wasmtime, but I could swap it out for another wasm runtime without too much trouble. I’m mostly using it as a test runner; it’s a very convenient way to run some wasm from Rust code. Nothing about the compiler toolchain requires wasmtime specifically. &lt;a href=&quot;https://ryanisaacg.com/posts/recurse-week-8.html#fnref1&quot; aria-label=&quot;Back to reference 1&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</content>
    </entry>
  
  
  
    <entry>
      <title>Recurse Center: Week 7</title>
      <link href="https://ryanisaacg.com/posts/recurse-week-7.html"/>
      <updated>2024-08-20T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/recurse-week-7.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;In the back half of my batch, job search and life have begun to cut into my RC time just a little. I’m feeling a little bit less productive as a result, but did get some stuff done:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The &lt;a href=&quot;https://ryanisaacg.com/posts/wasmtime-dl&quot;&gt;&lt;code&gt;wasmtime-dl&lt;/code&gt; blog post is out&lt;/a&gt;, which is my longest post yet (both in terms of my RC batch and all the posts before it). I’m pretty proud of it and feel excited to write more deeply here.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;To get that blog post looking good, I &lt;a href=&quot;https://ryanisaacg.com/posts/markdown-it-callouts&quot;&gt;wrote and used an NPM package&lt;/a&gt; to generate HTML for Obsidian callouts.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I did a couple playtests of &lt;a href=&quot;https://github.com/ryanisaacg/concerto&quot;&gt;concerto&lt;/a&gt;, an audiovisual webtoy I worked on in the first half of my batch. It’s pretty much ready for me to write it up and share.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/ryanisaacg/shelves&quot;&gt;My implementation&lt;/a&gt; of &lt;a href=&quot;https://browser.engineering/&quot;&gt;browser.engineering&lt;/a&gt; is up to the start of chapter 4. I can parse a subset of HTML, but not do anything with it yet.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I made two changes to how &lt;a href=&quot;https://github.com/ryanisaacg/brick&quot;&gt;Brick&lt;/a&gt;’s runtime works:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Instead of requiring it to be built manually, I set up a Rust build script so that the runtime will be automatically rebuilt.&lt;/li&gt;
&lt;li&gt;I wrote a small crate to expose some things that were previously internals in the Rust compiler’s output.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;With these two changes, I can now link the runtime module directly to the compiled binary with &lt;a href=&quot;https://docs.rs/wasmtime/latest/wasmtime/struct.Linker.html#method.module&quot;&gt;wasmtime’s Linker interface&lt;/a&gt;. Previously I had been writing the wasmtime bindings by hand; this is a big ergonomics improvement. It also tees up the improvement I’m trying to make in week 8, which is linking the application and runtime within the compiler itself.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</content>
    </entry>
  
  
    <entry>
      <title>High Crimes and Misdemeanors with WASM and Dynamic Linking</title>
      <link href="https://ryanisaacg.com/posts/wasmtime-dl.html"/>
      <updated>2024-08-19T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/wasmtime-dl.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;In &lt;a href=&quot;https://ryanisaacg.com/posts/programming-language-for-fun&quot;&gt;my programming language&lt;/a&gt;, currently codenamed Brick, I want to allow developers to pull in platform-native libraries written in other languages. Brick compiles to WebAssembly (wasm), and wasm is totally sandboxed by design. Without functions provided by the environment (“imports” in wasm lingo), a wasm module can have no side effects when run. I want Brick programs to have plenty of side effects, like making web requests or drawing graphics to the screen.&lt;/p&gt;
&lt;aside class=&quot;callout callout-info&quot;&gt;
&lt;h3 class=&quot;callout-title&quot;&gt;&lt;span class=&quot;callout-symbol&quot;&gt;ⓘ&lt;/span&gt;What does a wasm import look like?&lt;/h3&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;Let’s use Rust as an example. This is how we would define an external&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/wasmtime-dl.html#fn1&quot; id=&quot;fnref1&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt; function:&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;C&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;do_side_effect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;arg1&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;i32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; arg2&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;f32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here’s the corresponding wasm, expressed in the Web Assembly Text (WAT) format:&lt;/p&gt;
&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;env&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;do_side_effect&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;func&lt;/span&gt; $do_side_effect &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;param&lt;/span&gt; i32 f32&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/aside&gt;
&lt;p&gt;On desktop I’m running Brick programs via &lt;a href=&quot;https://github.com/bytecodealliance/wasmtime&quot;&gt;&lt;code&gt;wasmtime&lt;/code&gt;&lt;/a&gt;, a wasm runtime maintained by the folks behind the wasm spec. It’s written in Rust and exposes a Rust API, which allows us to attach Rust functions as a wasm module’s imports. This is great, because it allows us to include external libraries like &lt;code&gt;tokio&lt;/code&gt; for web requests or &lt;code&gt;macroquad&lt;/code&gt; for graphics. The linking API looks like this:&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;linker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;func_wrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;bindings&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// the name of the WASM module being imported&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;fill_rect&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// the name of the import in that module&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;move&lt;/span&gt; &lt;span class=&quot;token closure-params&quot;&gt;&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;f32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;f32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;f32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; h&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;f32&lt;/span&gt;&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;draw_rectangle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; h&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;WHITE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The only problem is that each of these bindings need to be written by hand in our Rust program. There’s no way to introduce new bindings at runtime, which makes it hard for Brick packages to use any external code I didn’t plan for.&lt;/p&gt;
&lt;p&gt;Here’s the goal: link our wasm binary directly with a dynamic library, without needing to hand-write these bindings.&lt;/p&gt;
&lt;aside class=&quot;callout callout-info&quot;&gt;
&lt;h3 class=&quot;callout-title&quot;&gt;&lt;span class=&quot;callout-symbol&quot;&gt;ⓘ&lt;/span&gt;What is linking?&lt;/h3&gt;&lt;p&gt;Linking is the process by which different binary objects form one application on an operating system. There are two types of linking: dynamic and static. Dynamic linking means that our application knows what libraries it needs to run, and functions it needs from those libraries, but it doesn’t store those functions directly. Instead the program asks the operating system for the library each time it runs&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/wasmtime-dl.html#fn2&quot; id=&quot;fnref2&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;. Static linking bundles a library’s contents directly into the binary, and is favored by Rust and Go. It allows the final result to be easily portable.&lt;/p&gt;
&lt;p&gt;In this case, because I want to include unforeseen-at-compile-time code, I need to use dynamic linking.&lt;/p&gt;
&lt;/aside&gt;
&lt;h2&gt;High Crime: Break down the sandbox&lt;/h2&gt;
&lt;p&gt;Enter &lt;code&gt;wasmtime-dl&lt;/code&gt;, a very bad idea I had. My goal was to break a hole in the side of the sandbox, and allow Brick packages to link to arbitrary dynamic libraries.&lt;/p&gt;
&lt;p&gt;The first design I sketched out was simple: given a set of function definitions, link the dynamic library with wasmtime. I had no idea how to accomplish this, but I’m in batch at the Recurse Center! It was time to work at the edge of my abilities.&lt;/p&gt;
&lt;aside class=&quot;callout callout-note&quot;&gt;
&lt;p&gt;When approaching something that I’m not sure how to do, I always try to tackle the riskiest part first. Risk is subjective at this phase; risk factors include “is this possible?” or “will this be prohibitively difficult?” or “will something make me change my mind?” Often this approach saves me a lot of grief down the road. On this project there seemed to be three main parts: reading some external function description, creating a wasmtime binding, and linking to a dynamic library. Only the third seemed high-risk, so I started there.&lt;/p&gt;
&lt;/aside&gt;
&lt;p&gt;A long time ago, I wrote games in C. I remembered trying and failing to set up hot reloading for the games, so I could recompile them without having to relaunch the game. In those explorations I encountered the &lt;code&gt;dlopen&lt;/code&gt; Linux system call, which allows you to load dynamic libraries at runtime. I searched “&lt;code&gt;dlopen&lt;/code&gt; Rust”, which was a good-enough starting point. I found a few crates that all did roughly the same thing: open a dynamic library, and return a function pointer for a given symbol name in that library.&lt;/p&gt;
&lt;p&gt;Of the available crates I settled on &lt;code&gt;libloading&lt;/code&gt;; here’s an example of how it works from &lt;a href=&quot;https://docs.rs/libloading/latest/libloading/&quot;&gt;the docs&lt;/a&gt;:&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; lib &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;libloading&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Library&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/path/to/liblibrary.so&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; func&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;libloading&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Symbol&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;u32&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; lib&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;b&quot;my_func&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So now we can definitely take a dynamic library and starting pulling functions out of it. Great, on to the next step: grabbing these functions dynamically.&lt;/p&gt;
&lt;h2&gt;High Crime: 1 million lines of Rust&lt;/h2&gt;
&lt;p&gt;Here I encountered my first major obstacle. I need to tell Rust what the type of the function pointer is before I can call it. I don’t think this is even a safety concern; how can the compiler emit code if it doesn’t know what values will be sent into the function call? Unfortunately I don’t know the type at compile time; I’ll be reading the types in at runtime.&lt;/p&gt;
&lt;p&gt;I decided to solve my problem with a little code generation. By creating a very big match statement, I could dynamically pick the right type based on the runtime information. If the function definition was &lt;code&gt;(f32, f64, i32, f32)&lt;/code&gt; then I would match that tuple, and that match branch would create a function pointer with type &lt;code&gt;fn(f32, f64, i32, f32)&lt;/code&gt;. Type problems solved! I wrote a quick Python program to generate my match statements and hit run.&lt;/p&gt;
&lt;p&gt;After it ran for a few seconds I started to get suspicious. “Why is it taking so long?”, I thought. I had tried to generate up to 16 arguments (which seems like a reasonable number of arguments to me), with an optional return value. In wasm, types may be 32 or 64 bit and they may be integers or floats, giving us four types: &lt;code&gt;i32&lt;/code&gt;, &lt;code&gt;f32&lt;/code&gt;, &lt;code&gt;i64&lt;/code&gt;, and &lt;code&gt;f64&lt;/code&gt;. Surely the number of combinations couldn’t be that great! I punched it into Wolfram Alpha just to double check and almost fell out of my chair: 4 parameter types and one optional return type, for every parameter length up to 16, gives over one million combinations.&lt;/p&gt;
&lt;p&gt;Numbers! How could you do this to me??? Let alone the time to generate 3 million lines of Rust, imagine the time to compile it. Forget office fencing, you’ll have time to run a whole office LARP!&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgs.xkcd.com/comics/compiling.png&quot; alt=&quot;XKCD comic strip. two stick figures fence on office rolling chairs while waiting for their code to compile&quot; /&gt;&lt;/p&gt;
&lt;p&gt;I scoped my ambitions way down and generated up to 4 parameters instead, which is still a CPU-crushing 15,700 lines of Rust. Even though it took minutes to compile, I had my first working prototype.&lt;/p&gt;
&lt;p&gt;The interface looked like this:&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(Copy, Clone)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;token type-definition class-name&quot;&gt;ValType&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token constant&quot;&gt;I32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token constant&quot;&gt;F32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token constant&quot;&gt;I64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token constant&quot;&gt;F64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token type-definition class-name&quot;&gt;WasmFuncImport&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&#39;a&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; module&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&#39;a&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&#39;a&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; params&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&#39;a&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ValType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; returns&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Option&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ValType&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;link&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// linker provided by wasmtime&lt;/span&gt;
    linker&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Linker&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// path to the dynamic library&lt;/span&gt;
    dynamic_lib&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AsRef&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;OsStr&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// type definitions for the wasm imports&lt;/span&gt;
    imports&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;WasmFuncImport&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&#39;_&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The generated code in that function is sorta unreadable, but you can &lt;a href=&quot;https://github.com/ryanisaacg/wasmtime-dl/blob/14c0ce31e9052b8bc83e3506573295e246453471/src/lib.rs#L33&quot;&gt;check it out on GitHub&lt;/a&gt; if you want to see it for yourself.&lt;/p&gt;
&lt;h2&gt;Misdemeanor: Why define the bindings?&lt;/h2&gt;
&lt;p&gt;You shouldn’t have to define the bindings - they’re right there in the binary! I’m not sure if I realized this in the shower, or on the train, or at the gym, but it hit me like a bolt of lightning. A wasm binary defines the types of its imports, including what parameters and return values functions have.&lt;/p&gt;
&lt;aside class=&quot;callout callout-info&quot;&gt;
&lt;p&gt;Remember our Rust example from before? &lt;code&gt;do_side_effect&lt;/code&gt;’s type is encoded right in the wasm:&lt;/p&gt;
&lt;pre class=&quot;language-lisp&quot;&gt;&lt;code class=&quot;language-lisp&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;env&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;do_side_effect&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;func&lt;/span&gt; $do_side_effect &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token car&quot;&gt;param&lt;/span&gt; i32 f32&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/aside&gt;
&lt;p&gt;That means we can save some work for &lt;code&gt;wasmtime-dl&lt;/code&gt;’s caller. Instead of asking them for some external definition for each function, we’ll just use the one provided by the wasm binary.&lt;/p&gt;
&lt;p&gt;The first experimental version worked! Driving the function bindings by examining the imports of the module itself meant that the user only needed to provide a wasm module and a dynamic library, and &lt;code&gt;wasmtime-dl&lt;/code&gt; could drive the rest. Our interface from before can remove user-provided binding definitions entirely; doesn’t it look so much simpler?&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;link&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// linker provided by wasmtime&lt;/span&gt;
    linker&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Linker&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// path to the dynamic library&lt;/span&gt;
    dynamic_lib&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AsRef&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;OsStr&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// the wasm blob as loaded by wasmtime&lt;/span&gt;
    wasm_module&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It was only after I had done the work that I realized it was fatally flawed. In wasm, pointers are represented as &lt;code&gt;i32&lt;/code&gt; values. The wasm binary format provides no distinction between a regular integer and one that is used as a pointer, but that distinction matters a lot to our binding program. Before we can pass the pointer to an external library, we need to add the offset where the wasm VM’s memory starts. Within wasm a pointer might look like the value &lt;code&gt;12&lt;/code&gt; (the 12th byte of the VM’s memory), but outside it will look like more like &lt;code&gt;0x0ffac12&lt;/code&gt; (the actual RAM location where the WASM VM’s memory is stored, plus 12).&lt;/p&gt;
&lt;p&gt;We &lt;em&gt;could&lt;/em&gt; just have annotations for which parameters and return values of imports functions are pointers, but what’s the point&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/wasmtime-dl.html#fn3&quot; id=&quot;fnref3&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[3]&lt;/a&gt;&lt;/sup&gt;? Once we need annotations on some functions, we may as well accept the need for annotations on every function. I added a new variant to &lt;code&gt;ValType&lt;/code&gt; to represents a pointer; it counts as an &lt;code&gt;i32&lt;/code&gt; on the WASM side and a &lt;code&gt;u64&lt;/code&gt; on the host side.&lt;/p&gt;
&lt;aside class=&quot;callout callout-note&quot;&gt;
&lt;p&gt;Technically &lt;code&gt;wasmtime-dl&lt;/code&gt; isn’t portable because it assumes the host pointers are 64-bit, which doesn’t account for 32-bit systems. In practice… basically all desktop computers are 64 bits nowadays, right?&lt;/p&gt;
&lt;/aside&gt;
&lt;h2&gt;Misdemeanor: Floats and ints… they’re all just bytes, right?&lt;/h2&gt;
&lt;p&gt;At this point I had another good? bad? idea. To cut down on the combinatorial explosion, what if I pretended that all float parameters are ints? An &lt;code&gt;f32&lt;/code&gt; or an &lt;code&gt;i32&lt;/code&gt; are both 32-bit chunks of data; the only difference between them is how you interpret those 32 bits. By treating all parameters to the dynamic library functions as &lt;code&gt;i32&lt;/code&gt; or &lt;code&gt;i64&lt;/code&gt; we can drastically cut down on the number of generated match cases.&lt;/p&gt;
&lt;p&gt;This required some finagling. First, instead of getting to use the convenient type-safe methods on wasmtime’s &lt;code&gt;Linker&lt;/code&gt;, I had to drop down into the less-convenient, less-safe, and slower “raw” binding mode. Second, I discovered that punning an &lt;code&gt;f32&lt;/code&gt; into an &lt;code&gt;i32&lt;/code&gt; was a little more complicated than I initially expected. After a few iterations where the bindings produced total gibberish, I ended up with a pretty simple use of the &lt;a href=&quot;https://crates.io/crates/bytemuck&quot;&gt;&lt;code&gt;bytemuck&lt;/code&gt;&lt;/a&gt; crate to transmute the provided f32 bytes into an i32.&lt;/p&gt;
&lt;aside class=&quot;callout callout-info&quot;&gt;
&lt;h3 class=&quot;callout-title&quot;&gt;&lt;span class=&quot;callout-symbol&quot;&gt;ⓘ&lt;/span&gt;Binding Example&lt;/h3&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;For a given function signature of &lt;code&gt;func(f32, i64)&lt;/code&gt;, we can match it like this:&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ParamType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;I32&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ParamType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;F32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ParamType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;I64&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ParamType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;F64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;None&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/aside&gt;
&lt;p&gt;By constraining the combinatorial space, I managed to fit in up to eight parameters in the generated code. It still takes minutes to compile though, even on an M1 Mac, so it’s not exactly lightweight.&lt;/p&gt;
&lt;h2&gt;A snag: structs&lt;/h2&gt;
&lt;p&gt;I was excited to have created this horrible beast. To make a little demo I decided to pull in &lt;a href=&quot;https://www.raylib.com/index.html&quot;&gt;&lt;code&gt;raylib&lt;/code&gt;&lt;/a&gt;, a simple C library for creating games, and call it from some wasm. As I scrolled through the raylib API, it hit me: wasm doesn’t know about structs! Any C function that takes a struct or union will expect it to conform to the C calling ABI; wasm only knows about its core primitive types. As it stands there’s no way to call a function that expects a non-primitive argument.&lt;/p&gt;
&lt;p&gt;This problem isn’t technically insurmountable, but it feels that way in a practical sense. I’m sure I could add an elaborate layer to marshal wasm parameters into structs, but that would explode my combination issue even further. Instead I decided to declare  victory (or defeat, depending your perspective), and write this blog post instead of productionizing &lt;code&gt;wasmtime-dl&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Verdict&lt;/h2&gt;
&lt;p&gt;My initial goal of binding from wasm imports to dynamic libraries has been achieved (with some criminal mischief along the way). It’s not a practical end product, but I learned a lot about dynamic linking and the limits of code generation! You can check out the &lt;a href=&quot;https://github.com/ryanisaacg/wasmtime-dl/&quot;&gt;&lt;code&gt;wasmtime-dl&lt;/code&gt; repo&lt;/a&gt; to see where I ended up, and you can pull in the crate if you want to be a victim of a compile-time crime.&lt;/p&gt;
&lt;p&gt;This auto-binding approach obviously isn’t going to pan out for Brick. Instead I’m going to experiment with an idea I’ve only seen in &lt;a href=&quot;https://www.roc-lang.org/&quot;&gt;Roc&lt;/a&gt;: the language requires an external program called a “platform” to run. The core language will remain the same, but the IO primitives and runtime characteristics will be determined by the platform. Considering the sandboxed model of wasm, this seems like a great fit for Brick! Stay tuned for a possible future post on the subject when I implement it.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Thanks to &lt;a href=&quot;https://metavee.github.io/&quot;&gt;Robin Neufeld&lt;/a&gt; for feedback on a draft of this post.&lt;/em&gt;&lt;/p&gt;
&lt;hr class=&quot;footnotes-sep&quot; /&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn1&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;It might seem a little odd to write &lt;code&gt;extern &amp;quot;C&amp;quot;&lt;/code&gt; instead of &lt;code&gt;extern &amp;quot;WASM&amp;quot;&lt;/code&gt;. The Rust WASM team &lt;a href=&quot;https://github.com/rustwasm/team/issues/29&quot;&gt;did consider a WASM-specific ABI&lt;/a&gt;, but ultimately decided against it. &lt;a href=&quot;https://ryanisaacg.com/posts/wasmtime-dl.html#fnref1&quot; aria-label=&quot;Back to reference 1&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&quot;fn2&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;I have no idea how this process works! I’m also not sure how much it varies by operating system. I know that all the major operating systems have their own dynamic library formats (&lt;code&gt;dll&lt;/code&gt; on Windows, &lt;code&gt;dylib&lt;/code&gt; on macOS, and &lt;code&gt;so&lt;/code&gt; on Linux), and that the OS searches various locations for a library when loading a library. &lt;a href=&quot;https://ryanisaacg.com/posts/wasmtime-dl.html#fnref2&quot; aria-label=&quot;Back to reference 2&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&quot;fn3&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;Pun intended. &lt;a href=&quot;https://ryanisaacg.com/posts/wasmtime-dl.html#fnref3&quot; aria-label=&quot;Back to reference 3&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</content>
    </entry>
  
  
    <entry>
      <title>My First NPM Package: markdown-it-callouts</title>
      <link href="https://ryanisaacg.com/posts/markdown-it-callouts.html"/>
      <updated>2024-08-14T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/markdown-it-callouts.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;I’ve got a blog post in the works that uses infoboxes. Previously I had a little snippet adapted from &lt;a href=&quot;https://github.com/rothsandro/eleventy-notes&quot;&gt;eleventy-notes&lt;/a&gt; so I could parse &lt;a href=&quot;https://help.obsidian.md/Editing+and+formatting/Callouts&quot;&gt;Obsidian callouts&lt;/a&gt; into &lt;code&gt;aside&lt;/code&gt; elements, but now I wanted to have special styling.&lt;/p&gt;
&lt;aside class=&quot;callout callout-info&quot;&gt;
&lt;h3 class=&quot;callout-title&quot;&gt;&lt;span class=&quot;callout-symbol&quot;&gt;ⓘ&lt;/span&gt;They look like this!&lt;/h3&gt;&lt;p&gt;&lt;/p&gt;
&lt;p&gt;It’s like my styling for asides, but a little more flexible. The colors can be changed, and a little symbol can be configured to show up next to the title.&lt;/p&gt;
&lt;/aside&gt;
&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;&lt;span class=&quot;token blockquote punctuation&quot;&gt;&gt;&lt;/span&gt; [!info] They&#39;re defined like this!
&lt;span class=&quot;token blockquote punctuation&quot;&gt;&gt;&lt;/span&gt; The first line is the title, and subsequent lines are the body.
&lt;span class=&quot;token blockquote punctuation&quot;&gt;&gt;&lt;/span&gt; You can put whatever elements you want in here too, like code blocks or images.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I rolled up my sleeves and added all the &lt;code&gt;markdown-it&lt;/code&gt; rendering code and CSS I needed. Once I had the new feature in place to correctly handle this non-standard markdown feature, I wanted to package it up for reusability&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/markdown-it-callouts.html#fn1&quot; id=&quot;fnref1&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;. The code is available &lt;a href=&quot;https://github.com/ryanisaacg/markdown-it-callouts&quot;&gt;on GitHub&lt;/a&gt;, but it’s surprisingly annoying to pull in a Typescript dependency via a Git link. I &lt;em&gt;could&lt;/em&gt; check in the compiled artifacts to source control, but that’s a poor practice if I can avoid it. Instead I decided to publish the package to npm.&lt;/p&gt;
&lt;p&gt;My first attempt to publish on npm only sent up my Typescript source files, which is gives you the same problems as pulling in the Github repo. I had to learn about the &lt;code&gt;package.json&lt;/code&gt; field &lt;code&gt;files&lt;/code&gt;, so that way npm would package up my artifacts and not my source code. Otherwise the publishing process was familiar to me from publishing Rust crates. I ran &lt;code&gt;npm publish&lt;/code&gt; and &lt;a href=&quot;https://www.npmjs.com/package/markdown-it-callouts&quot;&gt;the package went up on the registry&lt;/a&gt;. Feel free to check it out for your own projects, if you also want a convenient way to parse callouts.&lt;/p&gt;
&lt;hr class=&quot;footnotes-sep&quot; /&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn1&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;Other people being able to pull it in is a nice side effect; mostly I want to be able to share the functionality between my blogs. &lt;a href=&quot;https://ryanisaacg.com/posts/markdown-it-callouts.html#fnref1&quot; aria-label=&quot;Back to reference 1&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</content>
    </entry>
  
  
  
    <entry>
      <title>Recurse Center: Week 6</title>
      <link href="https://ryanisaacg.com/posts/recurse-week-6.html"/>
      <updated>2024-08-12T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/recurse-week-6.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;I’m halfway through my batch already! That can’t be true, can it? It feels like I just started!&lt;/p&gt;
&lt;p&gt;This week I:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Focused on &lt;a href=&quot;https://github.com/ryanisaacg/concerto&quot;&gt;Concerto&lt;/a&gt;. I got decent-sounding bells synthesized via Web Audio, and rewrote the backend to sync notes between clients. After an afternoon of wrangling with GCP I got the project deployed, and showed it off at Thursday presentations.&lt;/li&gt;
&lt;li&gt;Made some progress on my &lt;a href=&quot;https://browser.engineering/&quot;&gt;browser.engineering&lt;/a&gt; project, &lt;a href=&quot;https://github.com/ryanisaacg/shelves&quot;&gt;shelves&lt;/a&gt;. Thanks to some pairing with &lt;a href=&quot;https://annahope.me/&quot;&gt;Anna&lt;/a&gt;, I now have a GUI where my rendered text appears.&lt;/li&gt;
&lt;li&gt;Drafted my repeatedly-promised blog post about &lt;a href=&quot;https://github.com/ryanisaacg/wasmtime-dl/&quot;&gt;&lt;code&gt;wasmtime-dl&lt;/code&gt;&lt;/a&gt;. It needs a round of revisions, but I hope to have the post out this week.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In terms of code written, this was my least productive week so far! Partly the wasmtime blog post is the longest I’ve written yet, and it took more time than I expected. This was also my first week presenting anything, and I’m out of practice putting a talk together. My hope is that this upcoming week will reverse my low-productivity trend!&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Recurse Center: Week 5</title>
      <link href="https://ryanisaacg.com/posts/recurse-week-5.html"/>
      <updated>2024-08-05T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/recurse-week-5.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;During week 5, I mostly dedicated my attention to a project I’m calling “concerto”, which I started &lt;a href=&quot;https://ryanisaacg.com/posts/recurse-week-3&quot;&gt;in week three&lt;/a&gt;. It places users in a virtual world and allows them to play music notes, and simulates the notes expanding around the world. My initial draft in week 3 used 2D rendering and very basic note synthesis; this week, I moved to 3D rendering. I started with some very basic ThreeJS tutorials and progressed to a globe of the Earth, with note indicators spreading out along its surface. I had to do a fair bit of math to figure out how to convert (lat, long) pairs into angles, move circles along given axes, or rotate circles appropriately so they cling to the sphere’s surface.&lt;/p&gt;
&lt;p&gt;I also…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Did a little work on my programming language as a brain-break. Now structs correctly call their children’s destructors when their own destructors run!&lt;/li&gt;
&lt;li&gt;Started &lt;a href=&quot;https://browser.engineering/&quot;&gt;the browser.engineering book&lt;/a&gt; because a couple other folks in my batch are working through it. So far I’ve completed most of the chapter 1 exercises for making GET requests. The next step will be drawing things to the screen.&lt;/li&gt;
&lt;li&gt;Published &lt;a href=&quot;https://ryanisaacg.com/posts/db-internals-basics&quot;&gt;a blog post&lt;/a&gt; of what I’ve learned about database internals!&lt;/li&gt;
&lt;li&gt;Made a final stab at &lt;code&gt;wasmtime-dl&lt;/code&gt;, my project to dynamically link libraries into wasmtime environments. I thought I had a great idea to overcome my previous roadblock, but it didn’t end up panning out. Expect a blog post soon.&lt;/li&gt;
&lt;/ul&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Learning What the Heck is Inside SQLite</title>
      <link href="https://ryanisaacg.com/posts/db-internals-basics.html"/>
      <updated>2024-08-02T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/db-internals-basics.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Starting my batch at the Recurse Center, I knew one of the things I wanted to learn was the basics of database internals. My goal was to answer a basic question: “what does a database look like physically, from the perspective of files on disk?”&lt;/p&gt;
&lt;h2&gt;B+Trees&lt;/h2&gt;
&lt;p&gt;I started with &lt;a href=&quot;https://build-your-own.org/database/&quot;&gt;“Build Your Own Database From Scratch In Go”&lt;/a&gt;. By working through the first half of the book in Rust, I learned:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;“Logs” in databases mean something pretty different from what I’m used to. Instead of storing information about a program’s operation history, a “write ahead log” is a data structure you can safely append incoming operations to. This allows concurrent operations to be safely stored in a durable fashion, even if the process crashes mid-write.&lt;/li&gt;
&lt;li&gt;To build a persistent key/value store, it’s important to use a data structure where changes are atomic (again to be resilient to crashes mid-write). There are &lt;a href=&quot;https://en.wikipedia.org/wiki/Log-structured_merge-tree&quot;&gt;LSM-trees&lt;/a&gt;; all I know about them is that the acronym expands to Log-Structured Merge. There are also &lt;a href=&quot;https://en.wikipedia.org/wiki/B%2B_tree&quot;&gt;B+Trees&lt;/a&gt;, which I’ve gotten up close and personal with.&lt;/li&gt;
&lt;li&gt;For efficient manipulation of files on disk, it’s important to keep in mind segment sizes. The smallest possible disk read is often a few kilobytes; reading or writing less than that at a time is inefficient IO. Also, memory-mapping is the best approach if you need random access to disk.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Following along, I &lt;a href=&quot;https://github.com/ryanisaacg/catalog&quot;&gt;built a memory-mapped B+Tree in Rust&lt;/a&gt; to make sure I understood the concepts. A B+Tree consists of internal nodes with variable numbers of children and leaf nodes with data. Each node has a key, and the key type can be ordered between them. Internal nodes store the key ranges of their children, allowing them to determine which children to recurse to when finding a node. There’s also a rebalancing algorithm to split up nodes that get too large and condense nodes that get too small, to ensure that the height of the tree remains small (and thus fast to traverse).&lt;/p&gt;
&lt;p&gt;I think my implementation doesn’t fully rebalance itself (making it inefficient), but it does correctly handle get/insert/remove operations. Using &lt;code&gt;mmap&lt;/code&gt; means that the file is automatically updated under the hood, which is how some real database systems work. Unfortunately &lt;code&gt;mmap&lt;/code&gt; is super unergonomic in Rust, because I’m taking a byte array and doing a bunch of unsafe witchery to map the bytes to data structures. I think my use of &lt;code&gt;MaybeUninit&lt;/code&gt; in this code is actually unsound? So I wouldn’t use that B+Tree code as a good example of anything.&lt;/p&gt;
&lt;h2&gt;SQLite Format&lt;/h2&gt;
&lt;p&gt;In week 2 I joined some of my batchmates in writing SQLite from scratch. I decided to &lt;a href=&quot;https://github.com/ryanisaacg/sqlite&quot;&gt;go about this in Zig&lt;/a&gt;, partially to learn a new language and partially to avoid the memory-mapping problems I had in Rust. The first step is to parse &lt;a href=&quot;https://www.sqlite.org/fileformat.html#the_database_header&quot;&gt;the database file’s header&lt;/a&gt;, which is pretty simple. Things immediately kicked up a notch on the next step, as I began to dig into SQLite’s internal structures. Each SQLite database is represented by pages (4096 bytes in the test database, but it can be configured on a per-DB basis). Each page consists of a header, an array of internal pointers to “cells”, and then the cells themselves. A page is a node in a B+Tree, either a leaf or branch; these trees represent tables and indices in SQLite.&lt;/p&gt;
&lt;p&gt;All this actually sounds pretty simple. Let me assure you that there was plenty of room to write frustrating, hard-to-understand bugs along the way:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;All the integers in the format are big endian. Somehow I managed to read in exactly one value in the header in little endian, which took me hours to track down.&lt;/li&gt;
&lt;li&gt;Cells have a variable length, so their locations in the page data cannot be determined except by the cell-offset array.&lt;/li&gt;
&lt;li&gt;Pages are 1-indexed. Assuming pages are 0-indexed won’t fail loudly, but it will result in incorrect programs that report odd things.&lt;/li&gt;
&lt;li&gt;The cell offsets on the first database page treat the database header as belonging to that page, so their offsets aren’t relative to the page header but rather to byte 0.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;After I had worked through these initial obstacles, my program was able to enumerate the tables in a SQLite database file and read the &lt;code&gt;sqlite_schema&lt;/code&gt; table to determine their names. For now I’ve stopped there, because I feel like I’ve developed a good understanding of the physical basis of database file storage.&lt;/p&gt;
&lt;h2&gt;Takeaways&lt;/h2&gt;
&lt;p&gt;With what I learned from my projects, I can return to my initial question of “what does a database look like physically?” At its simplest, my answer is two core facts:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;A key-value store is represented by a tree (probably a B+Tree or an LSM tree) which allows for atomic writes.&lt;/li&gt;
&lt;li&gt;Each table in a SQL database can be thought of as a key-value store, with primary keys as keys and rows as values. Each column’s data is contained in the row, or in an overflow section the  row points to.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;My immediate curiosity is quenched, but the field of database implementation is vast and there are still plenty of things I’d like to learn!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How are queries planned? This is sort of the ‘missing middle’ in my mental model of SQL queries. I understand parsing pretty well and I think I now understand what primitives the database has to manipulate its tables, but I’m curious what happens between. This is the question I’m most interested in, and most likely to return to in my batch.
&lt;ul&gt;
&lt;li&gt;Sub-question: is a single-value query like &lt;code&gt;SELECT * FROM mytable WHERE mytable.id = 12345;&lt;/code&gt; going through the query planner? Or is this equivalent to a single key lookup operation? Likewise for full-table scans like &lt;code&gt;SELECT * FROM mytable;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;How are tables with multiple primary keys (like you’d use in an M:N relationship) represented? Are the keys concatenated?&lt;/li&gt;
&lt;li&gt;What is an index? I’ve never had cause to use one but I’ve also never worked with large volumes of production data in SQL.&lt;/li&gt;
&lt;li&gt;How do databases implement locking? My understanding is that SQLite only allows one writer for the database a time, but larger engines like MySQL or Postgres lock on a much more granular basis.&lt;/li&gt;
&lt;li&gt;What determines database performance characteristics? I’ve heard at truly large scales (e.g. Google) SQL doesn’t run fast enough; why is that? Is it a consequence of data layout, or the SQL query language, or the guarantees of the relational model?&lt;/li&gt;
&lt;li&gt;How are document databases (like Mongo or Firestore) similar or different to a key/value store or relational database under the hood?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;Thanks to Nicholas Walton and &lt;a href=&quot;https://annahope.me/&quot;&gt;Anna Hope&lt;/a&gt; for feedback on a draft of this post.&lt;/em&gt;&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Recurse Center: Week 4</title>
      <link href="https://ryanisaacg.com/posts/recurse-week-4.html"/>
      <updated>2024-07-31T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/recurse-week-4.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;In my fourth week I focused on the Recurse Game Jam, which ran from Monday to Thursday. I teamed up with &lt;a href=&quot;https://metavee.github.io/blog/&quot;&gt;Robin&lt;/a&gt; on her game &lt;a href=&quot;https://github.com/metavee/puzdug-x86&quot;&gt;puzdug-x86&lt;/a&gt;, a &lt;a href=&quot;https://en.wikipedia.org/wiki/Roguelike&quot;&gt;roguelike&lt;/a&gt; puzzle dungeon in x86 assembly. The game includes fog of war, player movement, mostly-static enemies, a win and loss condition, and color ASCII graphics. Robin had set out to make a game that fit in the boot sector, and we did briefly have a build that worked on a DOS-less Qemu instance! Unfortunately there is a 512 byte limit for the boot sector which we quickly shot past&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/recurse-week-4.html#fn1&quot; id=&quot;fnref1&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;; the final product for the game jam was a whopping 1KB (how excessive 😄).&lt;/p&gt;
&lt;p&gt;I loved working in such an unfamiliar and challenging environment as assembly. There’s a serenity to making a game with such an uphill climb, because it took pressure off my mind to make the game impressive. Shipping anything written in assembly is impressive enough, I think!&lt;/p&gt;
&lt;p&gt;I also…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Used Siri Shortcuts to parse a web endpoint for my local train times, and &lt;a href=&quot;https://ryanisaacg.com/posts/path-times&quot;&gt;blogged about it.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Finished up my &lt;a href=&quot;https://ryanisaacg.com/posts/learning-lsps&quot;&gt;first LSP blog post.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Made Hindsight, my “20 second break after 20 minutes of screen” app, a little smarter. Previously it checked if the Zoom app was running to avoid interrupting me in a call; now it checks to see if my camera is on instead.&lt;/li&gt;
&lt;li&gt;Went down a rabbit hole with wasm and dynamic linking. I didn’t end up achieving what I wanted to, but I learned some things that will hopefully make for an interesting blog post soon.&lt;/li&gt;
&lt;/ul&gt;
&lt;hr class=&quot;footnotes-sep&quot; /&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn1&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;Since the jam, Robin has further improved the game by adding a custom bootloader, so you &lt;em&gt;can&lt;/em&gt; boot directly into puzdug. &lt;a href=&quot;https://ryanisaacg.com/posts/recurse-week-4.html#fnref1&quot; aria-label=&quot;Back to reference 1&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Drafts that Fail Safe</title>
      <link href="https://ryanisaacg.com/posts/draft-fail-safe.html"/>
      <updated>2024-07-28T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/draft-fail-safe.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Last Friday I published a post on my blog entirely on accident. It was a short outline of just a few bullet points, sent to be turned into a full post over the next couple weeks. I thought it may be interesting to write a tiny incident report about how it happened and what I’m changing to avoid it happening again.&lt;/p&gt;
&lt;p&gt;My blog workflow mostly involves shuffling static files around between Obsididan and two git repos. I compose and edit posts in my Obsidian vault, sync them into my private “blog” git repo with a script, and process them with a static site generator&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/draft-fail-safe.html#fn1&quot; id=&quot;fnref1&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;. When I push that repo to GitHub, the SSG creates the HTML and makes an automated push to my GitHub Pages repo. Posts can be marked as draft; drafts don’t appear on the front page or the RSS Feed.&lt;/p&gt;
&lt;p&gt;Satisfied with &lt;a href=&quot;https://ryanisaacg.com/posts/learning-laps&quot;&gt;my post about language servers&lt;/a&gt;, I decided to publish it. I made final edits, removed the draft marker, synced the state of my repo, and published. I didn’t even check my site’s new build, because I felt confident in the output. Later that night &lt;a href=&quot;https://github.com/recursecenter/blaggregator&quot;&gt;Blaggregator&lt;/a&gt; informed me of &lt;strong&gt;two&lt;/strong&gt; new posts to my blog. One was my LSP post; the other was an outline I hadn’t even started writing.&lt;/p&gt;
&lt;p&gt;It turns out that I had totally forgotten to add the “draft” checkbox to my draft’s frontmatter in Obsidian. By design pages with no draft boolean are considered in a non-draft state, so that I didn’t have to modify my back catalogue of posts when I added the draft feature. When I made that decision I didn’t consider the high potential for unsafety it introduced. If I start jotting thoughts into a new draft, say on the train, it’s pretty easy to forget to configure the front matter. Then later it will get scooped up and published alongside something else.&lt;/p&gt;
&lt;p&gt;In order to avoid this issue again, I can see two workable changes. One is to &lt;em&gt;fail loudly&lt;/em&gt; and refuse to accept pages that aren’t definitively marked as “draft” or “not draft.” This will force me to go through and mark drafts as such before publication. It’s hard to imagine me adding the “draft” checkbox to a page’s frontmatter and then failing to check it. If I was worried about forgetting that last step I could go further and &lt;em&gt;fail safe&lt;/em&gt; by requiring pages to be affirmatively marked as “published.” No matter how careless or forgetful I am, I won’t be able to publish any draft I hadn’t proactively marked as ready. That’s what I ended up doing: I had to mark my old posts as “published”, and now my blog workflow is a little safer.&lt;/p&gt;
&lt;hr class=&quot;footnotes-sep&quot; /&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn1&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;At the time I was using Astro on this blog, after having tried Hugo and Zola (the latter of which I used for many years). Over the weekend I switched to 11ty because I was frustrated with Astro’s RSS generation feature. &lt;a href=&quot;https://ryanisaacg.com/posts/draft-fail-safe.html#fnref1&quot; aria-label=&quot;Back to reference 1&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Learning About the Language Server Protocol</title>
      <link href="https://ryanisaacg.com/posts/learning-lsps.html"/>
      <updated>2024-07-26T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/learning-lsps.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;As part of &lt;a href=&quot;https://ryanisaacg.com/posts/programming-language-for-fun&quot;&gt;my programming language project&lt;/a&gt;, I’ve been writing a language server. I’m familiar with the very basics of the &lt;a href=&quot;https://microsoft.github.io/language-server-protocol/&quot;&gt;LSP&lt;/a&gt; from integrating Neovim with projects like &lt;code&gt;rust-analyzer&lt;/code&gt;, but this is the first time I’ve dug into its internals.&lt;/p&gt;
&lt;p&gt;The protocol consists of JSON messages exchanged&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/learning-lsps.html#fn1&quot; id=&quot;fnref1&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt; between a server and a client. The server understands the programming language and does all the processing. The client&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/learning-lsps.html#fn2&quot; id=&quot;fnref2&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt; interacts with the server in a high-level way, abstracting the difference between programming languages. Most exchanges involve a request from the client and a response from the server;&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;https://ryanisaacg.com/client-server-request.svg&quot; class=&quot;diagram&quot; alt=&quot;A diagram demonstrating neovim sending a request and rust-analyzer responding&quot; /&gt; &lt;/p&gt;
&lt;p&gt;some go the other direction (the server requests and the client responds).&lt;/p&gt;
&lt;p&gt; &lt;img src=&quot;https://ryanisaacg.com/server-client-request.svg&quot; class=&quot;diagram&quot; alt=&quot;A diagram demonstrating rust-analyzer sending a request and Neovim responding&quot; /&gt; &lt;/p&gt;
&lt;p&gt;Still others are one-way messages with no response; these are called “notifications” in the LSP spec.&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;https://ryanisaacg.com/lsp-notif.svg&quot; class=&quot;diagram&quot; alt=&quot;A diagram demonstrating neovim sending a notification to rust-analyzer and rust-analyzer sending a notification to neovim&quot; /&gt; &lt;/p&gt;
&lt;p&gt;Different clients and servers can have different “capabilities”, which they exchange during initial connection.&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/learning-lsps.html#fn3&quot; id=&quot;fnref3&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[3]&lt;/a&gt;&lt;/sup&gt; For example, there’s a capability &lt;code&gt;definitionProvider&lt;/code&gt; which the server may or may not have. If a server doesn’t advertise this capability, the client’s interface shouldn’t show “go to definition” controls.&lt;/p&gt;
&lt;aside&gt;
&lt;p&gt;This can be lead to a footgun in early development: forgetting to enable a capability you’re newly adding. When I first added a goto-definition handler, logs showed that my commands weren’t even reaching the language server. I spent a little while debugging my goto-definition handler in confusion, before I realized I needed to report &lt;code&gt;definitionProvider: true&lt;/code&gt;. Once I reported the capability, my commands began to reach the server.&lt;/p&gt;
&lt;/aside&gt;
&lt;p&gt;At various points in the document lifecycle, the client notifies the server of changes. This is why &lt;code&gt;rust-analyzer&lt;/code&gt; can typecheck your files even before you save; your editor is sending your changes to the server as notifications. Depending on what capabilities the server advertises, it can receive events like “documented opened”, “document changed”, “document closed”, “document renamed”, etc. It’s expected to track changes internally, as future commands will reference these unsaved versions of the documents.&lt;/p&gt;
&lt;p&gt;There are all sorts of features that servers can support. Some are user-initiated actions, like:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Goto definition&lt;/li&gt;
&lt;li&gt;Find references&lt;/li&gt;
&lt;li&gt;Highlight instances of a symbol&lt;/li&gt;
&lt;li&gt;Retrieve hover information&lt;/li&gt;
&lt;li&gt;Run “code actions” (like importing unknown names or refactoring code blocks)&lt;/li&gt;
&lt;li&gt;Rename a given symbol&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There are other requests that the client makes without user input, such as:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Inlay hints (used for type annotations in &lt;code&gt;rust-analyzer&lt;/code&gt;, I don’t think they’re in Neovim)&lt;/li&gt;
&lt;li&gt;Inline values (not sure what these are used for, they’re not in Neovim I think)&lt;/li&gt;
&lt;li&gt;Completion options (this is technically kicked off by user input but rarely a specific command in the interface)&lt;/li&gt;
&lt;li&gt;Semantic syntax highlighting&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You’ll notice that the line between “user actions” and “editor actions” is blurry. The LSP spec itself makes no distinction between user-initiated and automatic requests; they all come from the client and the server handles them the same way.&lt;/p&gt;
&lt;p&gt;Inline errors (“diagnostics” in the spec) are usually pushed from the server to the client as a notification. The spec makes no requirement of when this notification can be made, which means that compilation and type-checking can happen asynchronously. Servers are responsible for clearing out diagnostics if a compilation succeeds, by sending a “publish diagnostics” notification with an empty body.&lt;/p&gt;
&lt;p&gt;I still have more to learn about the spec! While browsing I’ve seen references to CodeLens and Workspaces. I’m not sure these features exist in my editor? I’ve never encountered them at least. If I want to provide excellent VSCode support for my language, I’ll revisit them and try to learn what they are.&lt;/p&gt;
&lt;p&gt;In a future post, I plan to talk through the language server I’ve created and the design decisions I’m making as I work through it.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Thanks to &lt;a href=&quot;https://github.com/ttiimm&quot;&gt;Tim Likarish Ellis&lt;/a&gt; for feedback on a draft of this post.&lt;/em&gt;&lt;/p&gt;
&lt;hr class=&quot;footnotes-sep&quot; /&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn1&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;The specification allows for many different underlying communication mechanisms. I think Neovim is mostly using stdin/stdout, but servers can also communicate over sockets or other IPC mechanisms. &lt;a href=&quot;https://ryanisaacg.com/posts/learning-lsps.html#fnref1&quot; aria-label=&quot;Back to reference 1&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&quot;fn2&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;I only know of using text editors as LSP clients, like VSCode or Neovim. There may be other possible clients, but I don’t know of them. &lt;a href=&quot;https://ryanisaacg.com/posts/learning-lsps.html#fnref2&quot; aria-label=&quot;Back to reference 2&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&quot;fn3&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;Servers may register new capabilities or unregister existing ones at runtime. Clients may or may not support dynamic registration. I’m not sure what circumstances would lead a server to change its capabilities at runtime, but the option is there? &lt;a href=&quot;https://ryanisaacg.com/posts/learning-lsps.html#fnref3&quot; aria-label=&quot;Back to reference 3&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Checking train times with Shortcuts</title>
      <link href="https://ryanisaacg.com/posts/path-times.html"/>
      <updated>2024-07-24T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/path-times.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;I live in Jersey City and rely on the &lt;a href=&quot;https://en.wikipedia.org/wiki/PATH_(rail_system)&quot;&gt;PATH&lt;/a&gt; to get into the city. During commute windows, headways are conveniently every 5 minutes. Outside of those windows, the Newark↔World Trade Center line plummets to every 20 minutes. There’s no use leaving my apartment whenever I’m ready; I &lt;em&gt;have&lt;/em&gt; to plan around the train schedule. The PATH’s app does not make this easy. Real-time station information can be pinned to the app’s homepage, but it takes an seconds or minutes to load. The non-real-time schedule requires multiple taps, each with their own little loading segments to access. If I’m getting ready to go, it’s pretty annoying to figure out what train I should be shooting for.&lt;/p&gt;
&lt;p&gt;While I’m at the Recurse Center, I figured I should embrace the hacker spirit and solve this problem with some software. My first thought was an SMS-based solution. NJ Transit allows you to text them with a bus or light rail stop number in exchange for arrival times; I think the MTA has something similar. I planned to build a shortcut which would send the correct text and report the result, so I could trigger the workflow at the press of a button. Unfortunately… the PATH has no such texting-based option. Clearly I’d have to some programming, so I began to search for what sort of API the PATH exposed.&lt;/p&gt;
&lt;p&gt;Fool that I am, expecting answers to be so simple. There is no public-facing PATH API, at least not one that’s immediately apparent. Fortunately, someone else has already &lt;a href=&quot;https://medium.com/@mrazza/programmatic-path-real-time-arrival-data-5d0884ae1ad6&quot;&gt;reverse-engineered the PATH app and published their findings.&lt;/a&gt; The reason real-time data takes so long to load in the app is that it’s subscribed to the next &lt;em&gt;update&lt;/em&gt;, not retrieving the information directly. It seems there’s no official PATH endpoint to retrieve the most recent train data at all! Thankfully for me, the aforementioned reverse engineer has a cache to store each update and make it available over an HTTP API. Phew.&lt;/p&gt;
&lt;p&gt;With an HTTP API in hand, I began to think about how best to use it. Bookmark the URL and read the JSON myself? No, the train times are in UTC and mentally converting them to Eastern would be too much work. Create a tiny webpage that displays the information? Maybe, but it doesn’t seem that convenient to access at a moment’s notice. Write an app? That seemed too heavyweight for my goals. I happened to be on the train while thinking of my next step, and reached for a tool available on my phone: &lt;a href=&quot;https://support.apple.com/guide/shortcuts/welcome/ios&quot;&gt;iOS Shortcuts&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Shortcuts is a drag-and-drop programming language Apple makes available for system automation. It comes with a few built-in tools, and third-party apps can make actions available if they’re installed. I was delighted to discover one of the built-in tools could send an HTTP request and another could convert the JSON result into a Shortcuts Dictionary. Some fiddling with loops and variables ensued, and I was left with a script that retrieves the HTTP data and creates simple textual output as a result. You can check out &lt;a href=&quot;https://www.icloud.com/shortcuts/25814ae385ce46a593d6d2ea602a6b65&quot;&gt;the finished product&lt;/a&gt; if you have an Apple device of some kind.&lt;/p&gt;
&lt;p&gt;Siri integration with Shortcuts is out-of-the-box, so my solution ended up more convenient than I expected. Now I can long-press my watch crown button and ask for the path times, and after a second or two my watch will read off the upcoming departures from my local station. This is exactly what I wanted: no-fuss train information that doesn’t break my flow as I get ready.&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Recurse Center: Week 3</title>
      <link href="https://ryanisaacg.com/posts/recurse-week-3.html"/>
      <updated>2024-07-22T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/recurse-week-3.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;My third week at Recurse was a little more eclectic than the past two:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I got halfway done with my plans to add subscription support to my toy document store - currently you can subscribe to individual documents, but subscriptions to collections of documents aren’t supported.&lt;/li&gt;
&lt;li&gt;For “Impossible Stuff Day” I started on a web toy that connects many users, all playing piano notes that propagate from their locations in near-real-time. True to the theme of Impossible Stuff I didn’t quite hit the mark: my visualization of lat/long didn’t come together, and the piano notes themselves sound very harsh. I’ll probably pick this project back up in week 5 and polish those aspects!&lt;/li&gt;
&lt;li&gt;At Creative Coding I made a tiny text game with &lt;a href=&quot;https://github.com/swlody&quot;&gt;Sam&lt;/a&gt;. It pulls a random page from Simple English Wikipedia and replaces one of the words with a randomly chosen impostor. The player must guess which word doesn’t belong. It’s surprisingly fun for something we slapped together in two hours.&lt;/li&gt;
&lt;li&gt;Diagnostics from &lt;a href=&quot;https://ryanisaacg.com/posts/programming-language-for-fun&quot;&gt;my programming language&lt;/a&gt;’s LSP now show up in my editor (very excited about this one).&lt;/li&gt;
&lt;li&gt;The “practical language design” group met at a time that worked for me, and we talked about parser techniques.&lt;/li&gt;
&lt;li&gt;Got to chat with &lt;a href=&quot;https://www.scannedinavian.com/&quot;&gt;Shae&lt;/a&gt; about programming langauges, Haskell, Rust, substructural type systems, and a bunch of other stuff.&lt;/li&gt;
&lt;li&gt;Paired with &lt;a href=&quot;https://annahope.me/&quot;&gt;Anna&lt;/a&gt; on her project to create a reference-counted pointer in Zig. Bonus points: Got to play with &lt;a href=&quot;https://zed.dev/&quot;&gt;Zed’s&lt;/a&gt; collaboration tools for the first time.&lt;/li&gt;
&lt;li&gt;My blog now supports creating draft links which aren’t linked in its feeds, but can be shared privately. This will be very helpful for asking for feedback on draft posts.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This upcoming week I plan to participate in the RC game jam, write some blog posts about what I’ve learned thus far in my batch, and start learning the very basics of compiler optimizations. If inspiration strikes I’d like to write a program in &lt;a href=&quot;https://www.roc-lang.org/&quot;&gt;Roc&lt;/a&gt; or futz with Bluetooth.&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Recurse Center: Week 2</title>
      <link href="https://ryanisaacg.com/posts/recurse-week-2.html"/>
      <updated>2024-07-17T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/recurse-week-2.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Orientation is done! We’re in the batch for real now.&lt;/p&gt;
&lt;p&gt;A few folks in my batch were interested in the &lt;a href=&quot;https://app.codecrafters.io/courses/sqlite/overview&quot;&gt;CodeCrafters SQLite course&lt;/a&gt;, so I gave that a try. It didn’t end up meeting our expectations. Rather than giving any sort of step-by-step explanation of what you should do, the course just sort of links to the SQLite docs. I attempted to forge ahead regardless; after much frustration I made some tangible progress. &lt;a href=&quot;https://github.com/ryanisaacg/sqlite/&quot;&gt;My implementation&lt;/a&gt; can count the number of the tables in the a SQLite database, and tell you their names. I now feel confident that I &lt;em&gt;could&lt;/em&gt; write code that queries the data in a SQLite database, but I’m not sure I want to spend the rest of my batch down this rabbit hole. For now I’ll be putting it to the side.&lt;/p&gt;
&lt;p&gt;I tried to improve &lt;a href=&quot;https://github.com/ryanisaac/hindsight&quot;&gt;Hindsight&lt;/a&gt; (my app to remind me to take breaks while coding) by detecting if the camera is on, rather than if Zoom is open. At first I tried using a library but &lt;a href=&quot;https://github.com/sindresorhus/is-camera-on/issues/4&quot;&gt;it doesn’t work on my model of macbook&lt;/a&gt;, so for now Hindsight will remain un-improved. Someone did link to the apparent &lt;a href=&quot;https://github.com/wouterdebie/onair/issues/3&quot;&gt;source of the issue&lt;/a&gt;, so maybe I’ll take some time in the future to dig in and fix the problem?&lt;/p&gt;
&lt;p&gt;For my still-unnamed programming language I spent some time on &lt;a href=&quot;https://ryanisaacg.com/posts/programming-language-for-fun&quot;&gt;a blog post&lt;/a&gt; and made some progress on understanding language servers. I didn’t ship any major new features, but I did lay the foundation for supporting hover information and error highlighting&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/recurse-week-2.html#fn1&quot; id=&quot;fnref1&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;This week I also started two new projects: &lt;a href=&quot;https://github.com/ryanisaacg/iceload&quot;&gt;Iceload&lt;/a&gt; and &lt;a href=&quot;https://github.com/ryanisaacg/wasmtime-dl&quot;&gt;&lt;code&gt;wasmtime-dl&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Iceload is my toy clone of &lt;a href=&quot;https://firebase.google.com/docs/firestore&quot;&gt;Firestore&lt;/a&gt;, a document database with built-in pub/sub capabilities. My goal is to be able to get the developer experience of Firestore (easy setup, easy subscriptions to values, no need for a separate application server) in a local-first, “handmade” dev environment. I’m using &lt;a href=&quot;https://crates.io/crates/sled&quot;&gt;&lt;code&gt;sled&lt;/code&gt;&lt;/a&gt; for the key/value store and persistence&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/recurse-week-2.html#fn2&quot; id=&quot;fnref2&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;, and a websocket to communicate with clients. Currently basic document operations (get, insert, update, remove) all work! The next major steps are supporting subscriptions, creating the schema, and access control.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;wasmtime-dl&lt;/code&gt; is a truly cursed Rust crate. Given a shared library (&lt;code&gt;dll&lt;/code&gt; on Windows, &lt;code&gt;dylib&lt;/code&gt; on macOS, &lt;code&gt;so&lt;/code&gt; on Linux), I want to be able to expose that library’s exports to a wasmtime instance. Importantly I want to do this without needing to hand-write bindings that tell the wasmtime linker about the library; I want to drive the process with data instead. This is important for my programming language project; if I want my package to include some native functionality (say SDL2 bindings) I don’t want to have to drop down to Rust. Instead I should be able to describe the exported functions from the shared library and then bind it into the WASM VM. I’m excited to put &lt;code&gt;wasmtime-dl&lt;/code&gt; into “production” in week 3 as I build out functionality for programs to bind to their host environments.&lt;/p&gt;
&lt;p&gt;The curse of &lt;code&gt;wasmtime-dl&lt;/code&gt; is how it goes about this binding: 16,000 lines of generated Rust code to pattern match over possible shapes of functions. For every combination of &lt;code&gt;i32&lt;/code&gt;/&lt;code&gt;f32&lt;/code&gt;/&lt;code&gt;i64&lt;/code&gt;/&lt;code&gt;f64&lt;/code&gt; parameters (up to 4) and return values (including &lt;code&gt;void&lt;/code&gt; returns), there’s a match case generated. Then for every function with just &lt;code&gt;i32&lt;/code&gt; parameters (up to 16) and either a returned &lt;code&gt;i32&lt;/code&gt; or &lt;code&gt;void&lt;/code&gt; has its own case. Originally I wanted to support any primitive for up to 16 arguments, but the combinatorial explosion is real. That would have taken millions of lines of generated code, I think?&lt;/p&gt;
&lt;p&gt;At the very tail end of the week I started on the &lt;a href=&quot;https://raytracing.github.io/books/RayTracingInOneWeekend.html&quot;&gt;Raytracing in One Weekend&lt;/a&gt; with a pair of other Recursers in my batch. We got through all the setup and are poised to actually start tracing some rays, which should be fun!&lt;/p&gt;
&lt;p&gt;Week 2 was significantly more social than Week 1, because I spent a lot more time in-person at the hub. I find it hard to avoid going heads-down on my remote days, and end up wiling away the hours working without much interaction. As a result I find myself planning to spend as much time in the hub as possible, even though I’m a staunch remote-work fan. Something for me to think about over the next ten weeks, I guess!&lt;/p&gt;
&lt;hr class=&quot;footnotes-sep&quot; /&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn1&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;At the time of writing I’ve used that foundation to build error highlighting! Spoilers for next week’s post 🤫 &lt;a href=&quot;https://ryanisaacg.com/posts/recurse-week-2.html#fnref1&quot; aria-label=&quot;Back to reference 1&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&quot;fn2&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;At the start of my batch I didn’t even know how I &lt;em&gt;could&lt;/em&gt; possibly write my own persisted key/value store. Now that I’ve implemented a B-Tree and trawled through the SQLite file format I’m confident in my new abilities, but also aware of how much work it would be. I now feel much better about offloading that component to &lt;code&gt;sled&lt;/code&gt; and building atop prior art! &lt;a href=&quot;https://ryanisaacg.com/posts/recurse-week-2.html#fnref2&quot; aria-label=&quot;Back to reference 2&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Writing a Programming Language for Fun</title>
      <link href="https://ryanisaacg.com/posts/programming-language-for-fun.html"/>
      <updated>2024-07-15T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/programming-language-for-fun.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;For a little under a year I’ve been working on &lt;a href=&quot;https://github.com/ryanisaacg/my-programming-language/&quot;&gt;a programming language project&lt;/a&gt;. It’s a high level language that compiles to WebAssembly, designed to small games or scripts. Here I’ll introduce the language, explain my design decisions thus far, and complain about naming things.&lt;/p&gt;
&lt;h2&gt;An Example&lt;/h2&gt;
&lt;p&gt;Before I get into the weeds, I figured I should show off what a snippet of the language looks like:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import self.tilemap.Tilemap;
import self.tilemap.Tile;
import self.character_controller;
import self.character_controller.Input;

const TILE_SIZE = 32;

struct State {
    player: Player,
    map: Tilemap,
    input: Input,

    fn tick(self: unique State) {
        // Update
        character_controller.update_player(unique self.player, unique self.input, ref self.map);

        // Draw
        sdl.set_color(255, 255, 255, 255);
        sdl.clear();

        borrow player = ref self.player;
        sdl.set_color(255, 0, 0, 255);
        sdl.fill_rect(player.pos.x, player.pos.y, TILE_SIZE, TILE_SIZE);

        borrow tilemap = ref self.map;
        sdl.set_color(0, 0, 0, 255);
        let tile_x = 0;
        while tile_x &amp;lt; tilemap.width {
            let tile_y = 0;
            while tile_y &amp;lt; tilemap.height {
                let idx = tile_x * tilemap.height + tile_y;
                case tilemap.tiles[idx] {
                    Empty =&amp;gt; {}
                    Block =&amp;gt; {
                        sdl.fill_rect(tile_x * TILE_SIZE, tile_y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                    }
                }
                tile_y += 1;
            }
            tile_x += 1;
        }

        sdl.present();
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;With this little example in mind, why have I created this programming language?&lt;/p&gt;
&lt;h2&gt;(Writing a Programming Language) for Fun&lt;/h2&gt;
&lt;p&gt;Principally I started this project to enjoy the process and craft. Compilers are some of the most software-ass-software I’ve ever written: take as input a structured formal language, and output another structured formal language. It really satisfies the puzzle-solver in me.&lt;/p&gt;
&lt;p&gt;Given the project’s hobby origins, it has hobby goals. I am willing to make compromises on the language itself, the compiler, and the output all in service of having a good time. If I have to trade off a little expressiveness in the language to save a little complexity in the compiler, I’ll often take that trade. With that in mind, what am I compiling?&lt;/p&gt;
&lt;h2&gt;Writing (a Programming Language for Fun)&lt;/h2&gt;
&lt;p&gt;When I program for fun, it’s almost always in Rust. In many ways Rust is my dream language: an imperative programming model, a broad ecosystem, a WASM backend, a good safety story, and great tooling like Cargo. For games and little scripts, I find Rust less satisfying because of high compilation times and inconvenient zero-cost abstractions (e.g. having to repeatedly clone strings or &lt;code&gt;Rc&lt;/code&gt;s).&lt;/p&gt;
&lt;p&gt;My language is aimed at the niche of smaller programs which don’t need the full weight of Rust’s performance or expressive power. Its goals are to be easy to use, enable quick iteration, prevent silly mistakes, deploy to both web and desktop, and run efficiently enough to make games. Implementation concerns are allowed to override design concerns, but ideally they won’t have to. In making early design decisions, I took inspiration from Rust, TypeScript, my half-baked understanding of Go, &lt;a href=&quot;https://without.boats/blog/notes-on-a-smaller-rust/&quot;&gt;Notes on a smaller Rust&lt;/a&gt;, &lt;a href=&quot;https://graydon2.dreamwidth.org/307291.html&quot;&gt;The Rust I Wanted Had No Future&lt;/a&gt;, &lt;a href=&quot;https://www.scattered-thoughts.net/writing/implementing-interactive-languages/&quot;&gt;Implementing interactive languages&lt;/a&gt;, and &lt;a href=&quot;https://austral-lang.org/&quot;&gt;Austral&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;My first and easiest decision was types and type inference: all expressions have static types, and type information flows only in one direction. For the kind of programs I want to write, a full Hindley-Milner-style system seems like overkill. Instead each expression has a type entirely devoid of its context, and type information flows from the right hand side of declarations to the left. This is fundamentally similar to most imperative languages, especially ones that bolt on an &lt;code&gt;auto&lt;/code&gt; or &lt;code&gt;var&lt;/code&gt; keyword later in their design. We’ll see if I come to regret this decision when I get into more complex collections, but I think it’s an appropriate tradeoff.&lt;/p&gt;
&lt;p&gt;Struct-style product types were an easy choice, but it took me a little while to decide on my sum type. Originally in the interest of a simple language I considered something along the lines of variant records, as &lt;a href=&quot;https://journal.stuffwithstuff.com/2023/08/04/representing-heterogeneous-data/&quot;&gt;laid out by Bob Nystrom &lt;/a&gt;. I never implemented this idea completely, instead writing something that was an unholy combination of a variant record and a Rust enum. You could access each variant like a field, but it returned a nullable result. Once I was actually trying to write programs, I realized I wanted a proper sum type and implemented basic pattern-matching over my enums. That brings us to structs and enums, with limited pattern matching over the latter.&lt;/p&gt;
&lt;p&gt;Very early on I decided that this language wouldn’t permit mutable aliasing. Aside from the correctness and performance benefits, mandating that mutable references are exclusive makes code easier to read. I considered trying to learn about mutable value semantics because of interest in &lt;a href=&quot;https://www.hylo-lang.org/&quot;&gt;Hylo&lt;/a&gt; and &lt;a href=&quot;https://www.scattered-thoughts.net/writing/ruminating-about-mutable-value-semantics&quot;&gt;Zest&lt;/a&gt;, but they were out of my comfort zone&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/programming-language-for-fun.html#fn1&quot; id=&quot;fnref1&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;. I’ve opted for the more familiar Rust-style move semantics. Types may either be cheaply copied or are treated as affine&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/programming-language-for-fun.html#fn2&quot; id=&quot;fnref2&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;, but not both.&lt;/p&gt;
&lt;p&gt;Unlike Rust, I have decided that borrows are not a first-class type. They cannot be stored in user types, added to collections, returned from functions, or assigned to variables. Allowing borrows to potentially escape the scope they’re created in makes borrow-checking much harder. As a result I don’t plan to need lifetime annotations on borrows, which saves quite a bit of complexity and learning curve. Each borrow is limited entirely to its original lexical scope, and borrows may not be reassigned once created. As a result borrow-checking is a few hundred lines of code, and should be much less daunting to newcomers.&lt;/p&gt;
&lt;aside&gt;
&lt;p&gt;Second-class borrows will mean second-class slices. That’s fine in many cases, but I’m worried it will end up feeling restricted. If that bears out then my (unformed) plan is for “view types”, which share reference counts and locks with their parent collection. This way you could create (in Rust parlance) an &lt;code&gt;Arc&amp;lt;RwLock&amp;lt;Vec&amp;lt;T&amp;gt;&amp;gt;&amp;gt;&lt;/code&gt; once, and then have many &lt;code&gt;Arc&amp;lt;RwLock&amp;lt;[T]&amp;gt;&amp;gt;&lt;/code&gt; instances which reference it. This should prevent mutable aliasing, while regrettably losing a bit of static verifiability.&lt;/p&gt;
&lt;/aside&gt;
&lt;p&gt;The backend for the language is WASM&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/programming-language-for-fun.html#fn3&quot; id=&quot;fnref3&quot; aria-describedby=&quot;footnotes-label&quot; role=&quot;doc-noteref&quot;&gt;[3]&lt;/a&gt;&lt;/sup&gt;. It lets me target the browser or desktop with relative ease, and is totally cross-platform. So far it seems easy to emit and fast enough for my needs. My biggest frustration is the distinction between the program stack and linear memory; I understand the reason (security, ability to optimize, etc) but it does make reference types fairly annoying.&lt;/p&gt;
&lt;p&gt;Speed of execution has mostly worked out to my liking as a result of earlier decisions. When the types are known at compile time the memory layouts are as well, which makes emitted code pretty simple. I haven’t added any optimization yet; I think there should be some significant low-hanging fruit once I decide to start.&lt;/p&gt;
&lt;p&gt;Iteration speed also has just sort of worked out. The compiler is written in Rust and makes heavy use of &lt;a href=&quot;https://github.com/rayon-rs/rayon&quot;&gt;rayon&lt;/a&gt;: files are parsed and typechecked in parallel, and then functions are desugared, borrow-checked, and lowered to the “linear IR” in parallel. Code isn’t emitted in parallel, but it could be without much of a change. Compiling to WASM also means that I can implement hot-reloading quite easily. All that I need to do is create a new WASM instance and copy the memory from one instance to the other. I’ve already had fun writing a very tiny platformer character controller without having to close the running game.&lt;/p&gt;
&lt;h2&gt;Naming the Damn Thing&lt;/h2&gt;
&lt;p&gt;I’ve been working on this project on-and-off for about eight months. It’s now far enough along to write small toys, and I’ve begun writing a game. What I still don’t have is a name! The first name I picked was “brick”, a non-trademark-infringing nod to &lt;a href=&quot;https://en.wikipedia.org/wiki/Lego&quot;&gt;a toy that you use to build toys&lt;/a&gt;. After a while I discovered &lt;a href=&quot;https://github.com/brick-lang/brick&quot;&gt;there’s already a hobby PL project with that name&lt;/a&gt;, albeit one that seems to have been abandoned six years ago. I’d like to avoid a name collision if possible, but have found no other name candidate that called strongly to me. I’ve considered:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;“ludus”, Latin for “game”. Doesn’t sound fun though, it sounds like Latin&lt;/li&gt;
&lt;li&gt;“pyra”, as a shortening of “pyrite”. This is more of an inside joke with my name, but some surveying of friends turns out that the initial letters “py” strongly point to some association with Python&lt;/li&gt;
&lt;li&gt;“mortar”, suggested by a friend if I couldn’t take “brick.” It has &lt;a href=&quot;https://github.com/tonoy30/mortar&quot;&gt;a name collision&lt;/a&gt; (though an even more abandoned, less-used one) and doesn’t have much going for it outside of an allusion to an allusion.&lt;/li&gt;
&lt;li&gt;“block”, for the same reason as “brick”. Even worse name collisions: “block programming” is how &lt;a href=&quot;https://developers.google.com/blockly&quot;&gt;many&lt;/a&gt; &lt;a href=&quot;https://www.codejig.com/en/block-based-coding/&quot;&gt;visual&lt;/a&gt; &lt;a href=&quot;https://www.codewizardshq.com/what-is-block-coding/&quot;&gt;programming&lt;/a&gt; &lt;a href=&quot;https://en.wikipedia.org/wiki/Scratch_(programming_language)&quot;&gt;languages&lt;/a&gt; refer to themselves. Not to mention endless potential confusion over “blockchain”&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ideally a name would make some reference to the just-for-fun nature of the language. Secondarily I considered something that would obviously scan as a “smaller Rust”, but none of my ideas (“tarnish”, “oxidize”, etc) appealed to me. At this point I’m weighing going back to “brick”, but I’d really like to avoid the name collision. If you have any suggestions for names, please feel free to &lt;a href=&quot;https://ryanisaacg.com/posts/ryan@ryanisaacg.com&quot;&gt;send them my way&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;In future posts I plan to elaborate on specifics like the design of the compiler, linking the runtime, the language server, and features like coroutines or interfaces (both currently half-working).&lt;/p&gt;
&lt;hr class=&quot;footnotes-sep&quot; /&gt;
&lt;section class=&quot;footnotes&quot;&gt;
&lt;ol class=&quot;footnotes-list&quot;&gt;
&lt;li id=&quot;fn1&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;I could see myself revisiting this decision at some point in my batch at the Recurse Center, but currently my plate is pretty full without mutable value semantics. &lt;a href=&quot;https://ryanisaacg.com/posts/programming-language-for-fun.html#fnref1&quot; aria-label=&quot;Back to reference 1&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&quot;fn2&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;I wish the language around &lt;a href=&quot;https://en.wikipedia.org/wiki/Substructural_type_system&quot;&gt;substructural type systems&lt;/a&gt; was less opaque. Please check out &lt;a href=&quot;https://without.boats/blog/ownership/&quot;&gt;Without Boats’ post “Ownership”&lt;/a&gt;. It is the clearest explanation of “affine” and “linear” types I have read. &lt;a href=&quot;https://ryanisaacg.com/posts/programming-language-for-fun.html#fnref2&quot; aria-label=&quot;Back to reference 2&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&quot;fn3&quot; class=&quot;footnote-item&quot;&gt;&lt;p&gt;There’s also a tree-walking interpreter that runs on the lower-level IR directly. I wrote this early in development so I could build out the language in vertical slices. It’s slow and not intended for actual use, and has mostly served its purpose now that I emit WASM. The next time it slows down development I’ll probably delete it. &lt;a href=&quot;https://ryanisaacg.com/posts/programming-language-for-fun.html#fnref3&quot; aria-label=&quot;Back to reference 3&quot; role=&quot;doc-backlink&quot; class=&quot;footnote-backref&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Recurse Center: Week 1</title>
      <link href="https://ryanisaacg.com/posts/recurse_week_1.html"/>
      <updated>2024-07-08T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/recurse_week_1.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;I’m one week in to my &lt;a href=&quot;https://ryanisaacg.com/posts/hello-recurse&quot;&gt;batch at the Recurse Center&lt;/a&gt;! Here’s what I’ve done and learned so far.&lt;/p&gt;
&lt;p&gt;Monday and Tuesday were a little more orientation-y last week, so I got to virtually meet a lot of folks from my batch and get a sense of what other people are working on. Despite coming in with no interest or experience in audio programming, the enthusiasm of some other folks may sway me to try to learn digital audio basics over the next 11 weeks.&lt;/p&gt;
&lt;p&gt;My first project was a tiny, practical one: &lt;a href=&quot;https://github.com/ryanisaacg/hindsight&quot;&gt;Hindsight&lt;/a&gt;, a timer app that reminds me to take a 20 second break every 20 minutes. It’s my first time writing any Swift, so I’m sure it’s unidiomatic as all heck. There are plenty of improvements I’d like to make (only start the timer when I’m back at my keyboard, be smarter about detecting whether I’m in a video / audio call, don’t have the SwiftUI “hello world” window open all the time) but they’re not big priorities for me right now. It’s good enough!&lt;/p&gt;
&lt;p&gt;I wrote &lt;a href=&quot;https://github.com/ryanisaacg/catalog&quot;&gt;a memory-mapped B+Tree in Rust&lt;/a&gt; following along &lt;a href=&quot;https://build-your-own.org/database/&quot;&gt;“Build Your Own Database From Scratch in Go”&lt;/a&gt;. Along the way I learned what “logs” mean in the context of databases, the difference between a B+Tree and an LSM tree, and the impact of disk sectors on small IO performance. Overall this was pretty fun: it involved a lot more use of &lt;code&gt;unsafe&lt;/code&gt; in Rust than I would normally make. Unfortunately that’s also a sign that a B+Tree isn’t a great fit for Rust &lt;a href=&quot;https://github.com/rust-lang/rust/issues/27090#issuecomment-122345671&quot;&gt;(because you have to copy the keys around)&lt;/a&gt; and that memory mapping isn’t super ergonomic in Rust (because managing allocations in a fixed buffer is pretty annoying).&lt;/p&gt;
&lt;p&gt;For that reason I’m going to stop the project before the second half of the book, and instead follow along the &lt;a href=&quot;https://app.codecrafters.io/courses/sqlite/overview&quot;&gt;CodeCrafters Build Your Own SQLite&lt;/a&gt; course with some of my batchmates. For the CodeCrafters course I’m planning to use Zig, because this seems like a perfect opportunity to tear myself away from Rust for a second and explore. My last attempt to use Zig ended because I was frustrated with its choice of abstractions, but a more guided approach might ease me in.&lt;/p&gt;
&lt;p&gt;Later in the week I paired on Tim’s &lt;a href=&quot;https://github.com/ttiimm/log2src&quot;&gt;log2src&lt;/a&gt; project and drove while we did some refactoring. It’s &lt;em&gt;super cool&lt;/em&gt; to watch the debugger integration: you can step through the logs line-by-line, and VSCode highlights what line of your program printed the log. It even reconstructs the most likely call stack to get to that log point! I would never have thought that was even possible.&lt;/p&gt;
&lt;p&gt;I also worked on the language server for my (as of yet unnamed) &lt;a href=&quot;https://github.com/ryanisaacg/my-programming-language/&quot;&gt;hobby programming language&lt;/a&gt;. Expect a more in-depth post about the language and my LSP work on it later!&lt;/p&gt;
&lt;p&gt;My only regret for week 1 is that I wasn’t social enough. I spent too long heads down and not enough time pairing and hanging out. My main goals for week 2 are to change that, to make lots of progress on the SQLite course, and to maybe start reading about digital audio.&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>How to add a custom LSP server to nvim-lspconfig</title>
      <link href="https://ryanisaacg.com/posts/nvim-lspconfig-custom-lsp.html"/>
      <updated>2024-07-05T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/nvim-lspconfig-custom-lsp.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Normally the &lt;a href=&quot;https://github.com/neovim/nvim-lspconfig&quot;&gt;&lt;code&gt;nvim-lspconfig&lt;/code&gt; package&lt;/a&gt; has every language server I could possibly want, so I’ve found it pretty low maintenance. Currently I’m testing out the server for my own programming language, and I needed to add the LSP to my editor’s config. It was a surprisingly annoying task! I wanted to share the little snippet I used to get it configured.&lt;/p&gt;
&lt;p&gt;Briefly I considered forking &lt;code&gt;nvim-lspconfig&lt;/code&gt; and adding my LSP’s config to the &lt;code&gt;lua/lsp/server_configurations/&lt;/code&gt; folder, where all the official implementations live. I decided against because that seemed like an unnecessary hassle. Instead I searched out a way to do it from outside the plugin.&lt;/p&gt;
&lt;p&gt;First I found &lt;a href=&quot;https://github.com/neovim/nvim-lspconfig#example-custom-config&quot;&gt;a Reddit thread&lt;/a&gt; which linked to a header within the &lt;code&gt;nvim-lspconfig&lt;/code&gt; readme. That header… does not appear in the readme. A bit of trawling through the Wayback Machine got me the &lt;a href=&quot;https://web.archive.org/web/20210422212220/https://github.com/neovim/nvim-lspconfig#example-custom-config&quot;&gt;snippet I wanted&lt;/a&gt;!&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt; lspconfig &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; require&lt;span class=&quot;token string&quot;&gt;&#39;lspconfig&#39;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt; configs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; require&lt;span class=&quot;token string&quot;&gt;&#39;lspconfig/configs&#39;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;-- Check if it&#39;s already defined for when reloading this file.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt; lspconfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;foo_lsp &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
  configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;foo_lsp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    default_config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      cmd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;/home/ashkan/works/3rd/lua-language-server/run.sh&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      filetypes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;lua&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      root_dir &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fname&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; lspconfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find_git_ancestor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fname&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;or&lt;/span&gt; vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;loop&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;os_homedir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      settings &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
lspconfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;foo_lsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But that snippet didn’t do anything. Ugh!&lt;/p&gt;
&lt;p&gt;After some reading through &lt;code&gt;nvim-lspconfig&lt;/code&gt;’s source code, I took a wild guess: &lt;code&gt;nvim-lspconfig&lt;/code&gt; &lt;a href=&quot;https://github.com/neovim/nvim-lspconfig/blob/master/lua/lspconfig.lua#L1&quot;&gt;internally imports the config file&lt;/a&gt; through &lt;code&gt;require(&#39;lspconfig.configs&#39;)&lt;/code&gt;, but this snippet is using &lt;code&gt;require&#39;lspconfig/configs&#39;&lt;/code&gt;. Could that possibly make a difference? The answer appears to be yes, because the following is what worked for me:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;lspconfig.configs&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;my_custom_lsp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    default_config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        cmd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;path/to/my/binary&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        filetypes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;filetype&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        root_dir &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fname&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; lsp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find_git_ancestor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fname&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        settings &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now all I have to do is write the rest of the language server—how hard could that be?&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Hello Recurse! (Week 1, Day 1)</title>
      <link href="https://ryanisaacg.com/posts/hello-recurse.html"/>
      <updated>2024-07-01T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/hello-recurse.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Today I start a 12-week batch at the &lt;a href=&quot;https://www.recurse.com/&quot;&gt;Recurse Center&lt;/a&gt;!
Here at the outset my goals are:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Write a toy database! I’ve used databases before but never written one, and have no idea how database internals work. This is currently my main interest&lt;/li&gt;
&lt;li&gt;Explore distributed systems! I want to get some exposure to some variety beyond client/web server/database, especially streaming video.&lt;/li&gt;
&lt;li&gt;Go down a rabbit hole I don’t even know yet! I hope to get carried along by an unfamiliar current, to something like natural language processing, or music/signal processing, or something else entirely.&lt;/li&gt;
&lt;li&gt;Blog often! At the very least I want to blog once a week about my experience at RC and what I’m working on. If any of my projects end up interesting enough to stand alone, I wanna blog those as well.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Thus far today has been:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Orientation and learning about the internal software used to run RC&lt;/li&gt;
&lt;li&gt;Writing this blog post&lt;/li&gt;
&lt;li&gt;Getting a very basic Swift development environment working&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Tomorrow I want to start on a macOS app to remind me to stretch and move around. I’ve never done any real macOS or Swift programming, so my hope is that this will jar me out of my comfort zone nice and early. It also will serve the very practical purpose of keeping me healthy as I hack on my bigger projects for the rest of my batch.&lt;/p&gt;
&lt;p&gt;My batch runs from July 1 to September 20, so expect lots more posts from me as I go through RC!&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Neovim and VSCode</title>
      <link href="https://ryanisaacg.com/posts/nvim_and_vscode.html"/>
      <updated>2024-03-30T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/nvim_and_vscode.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Around a year ago, I decided to use Neovim as my editor for working on Unity-based projects. After &lt;a href=&quot;https://ryanisaacg.com/posts/TODO&quot;&gt;some involved setup&lt;/a&gt;, I thought I had everything just how I liked it. Then my autocomplete broke one too many times, and I knew it just wasn’t worth the hassle. It was time to bite the bullet and use VSCode; but could I do that without giving up Vim?&lt;/p&gt;
&lt;p&gt;Most text editors targeted towards programmer types have some kind of vim mode. Despite being an avid vim user, I never enable it. The emulation is never exact enough; invariably I’ll try something like a basic macro and completely fumble as I hit a missing feature or three. At that point I’d rather just use the basic EMacs shortcuts available in all macOS input fields. Previously I had tried a Vim plugin for VSCode and had the same disappointing experience. Neovim changed the game in Vim modes, though. The re-architecture of the project apparently allows Neovim to be fully embedded within other applications. Instead of relying on janky emulations, I can get the real thing.&lt;/p&gt;
&lt;p&gt;I installed &lt;a href=&quot;https://github.com/vscode-neovim/vscode-neovim&quot;&gt;the VSCode plugin&lt;/a&gt; and had to do some fiddling to get it recognize my &lt;code&gt;nvim&lt;/code&gt; binary (which I’ve unfortunately now forgotten). Then I had to &lt;a href=&quot;https://github.com/ryanisaacg/dotfiles/commit/ef085b3b9b4749c95327fedf3f78ad6e25ac3020&quot;&gt;make a few VSCode-specific tweaks to my config&lt;/a&gt;. I skipped loading basically all my usual plugins. LSP, syntax highlighting, git change markers: all these sorts of things are built into VSCode (and won’t work with the Neovim ⭤  VSCode bridge anyways). I also had to re-do all my custom keybindings (for example, opening a fuzzy finder when I hit &lt;code&gt;t&lt;/code&gt; in normal mode) to bind to VSCode actions instead. &lt;code&gt;vscode-neovim&lt;/code&gt; is a handy plugin that allows me to do that very easily.&lt;/p&gt;
&lt;p&gt;For the past few months I’ve been using this setup as a daily driver. The C# autocomplete integration works out of the box, unlike in my previous Neovim setup (because it’s a proprietary Microsoft extension &amp;gt;_&amp;gt;). Go-to-definition and find-references and all that are working fine. All around it’s a &lt;em&gt;much&lt;/em&gt; better C# editing experience. For the other projects in our monorepo (some Terraform and Typescript, mostly), things work fine. I would prefer to be back in my natural habitat (nvim + tmux + fish) but it’s more convenient to have the whole monorepo open in VSCode than to jump back and forth between environments.&lt;/p&gt;
&lt;p&gt;So on one hand, I did sorta give up on having my neovim + Unity setup from my last post. But on the other, I maybe have the best of both worlds?&lt;/p&gt;
</content>
    </entry>
  
  
  
    <entry>
      <title>Using Neovim with Unity</title>
      <link href="https://ryanisaacg.com/posts/nvim-and-unity.html"/>
      <updated>2023-04-26T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/nvim-and-unity.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;In the last few years I’ve switched fully to Neovim, and embraced the lua scripting and built-in LSP support. Most development I do these days tends to be TypeScript or Rust, and my editor’s integration with tooling like prettier, rustfmt, rust-analyzer, and tsc is great! Having recently started doing some work in Unity, however, I discovered that I would have to get my hands dirty for a good C# experience.&lt;/p&gt;
&lt;p&gt;I started off by searching around for other people’s experience using Neovim with Unity, and found &lt;a href=&quot;https://chrislabarge.com/posts/neovim-unity-engine/&quot;&gt;a decent blog post&lt;/a&gt; that walked me through the basic steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Configure Unity to send a message over a Unix socket to neovim when you want to open a file&lt;/li&gt;
&lt;li&gt;Create a script to launch neovim listening to that Unix socket&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I didn’t end up using exactly the solution they provide (&lt;code&gt;nvr&lt;/code&gt; doesn’t seem to be available as part of my neovim install) but after reading the documentation for nvim’s &lt;code&gt;--remote&lt;/code&gt; option I was able to set up this part of the ingration fine. When I opened a file in Unity, it would pop open in my vim session.&lt;/p&gt;
&lt;p&gt;The logical next step is some sort of LSP integration. I went for the officially-supported omnisharp-roslyn and installed it on my system. The nvim-lsp documentation recommended the &lt;code&gt;omnisharp_extended&lt;/code&gt; plugin for handling go-to-definition, so I added that to my config as well. My config ended up looking like this:&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;omnisharp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    cmd &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;mono&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;/Users/ryanisaacg/bin/omnisharp-osx/omnisharp/OmniSharp.exe&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;--languageserver&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;--hostPID&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;tostring&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pid&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    handlers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;textDocument/definition&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;omnisharp_extended&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;handler&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;-- Enables support for reading code style, naming convention and analyzer&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- settings from .editorconfig.&lt;/span&gt;
    enable_editorconfig_support &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;-- If true, MSBuild project system will only load projects for files that&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- were opened in the editor. This setting is useful for big C# codebases&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- and allows for faster initialization of code navigation features only&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- for projects that are relevant to code that is being edited. With this&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- setting enabled OmniSharp may load fewer projects and may thus display&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- incomplete reference lists for symbols.&lt;/span&gt;
    enable_ms_build_load_projects_on_demand &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;-- Enables support for roslyn analyzers, code fixes and rulesets.&lt;/span&gt;
    enable_roslyn_analyzers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;-- Specifies whether &#39;using&#39; directives should be grouped and sorted during&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- document formatting.&lt;/span&gt;
    organize_imports_on_format &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;-- Enables support for showing unimported types and unimported extension&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- methods in completion lists. When committed, the appropriate using&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- directive will be added at the top of the current file. This option can&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- have a negative impact on initial completion responsiveness,&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- particularly for the first few completion sessions after opening a&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- solution.&lt;/span&gt;
    enable_import_completion &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;-- Specifies whether to include preview versions of the .NET SDK when&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- determining which version to use for project loading.&lt;/span&gt;
    sdk_include_prereleases &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;-- Only run analyzers against open files when &#39;enableRoslynAnalyzers&#39; is&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- true&lt;/span&gt;
    analyze_open_documents_only &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and it worked pretty well! I could open up my files from Unity, have them pop open in Neovim, and they were properly integrated with the C# LSP. Unfortunately omnisharp apparently won’t search your PATH for &lt;code&gt;OmniSharp.exe&lt;/code&gt;, which means that this part of my config isn’t portable to other machines. Other than that, everything seemed just fine.&lt;/p&gt;
&lt;p&gt;After using this setup for a few days I ran into a problem. Whenever I created a new C# file, omnisharp would be completely borked: anything it defined was unavailable in other files and all of the imports in the new file would be marked as unresolved. I could fix the problems by restarting my entire editor, but omnisharp’s long boot time makes that painful. At this point I thought was defeated and started to configure VSCode for C#. Fortunately, a new update to Neovim saved the day! In the GitHub issue someone pointed out that the issue was the LSP client not properly handling the &lt;code&gt;didChangeWatchedFiles&lt;/code&gt; message from the server. Last week Neovim added experimental support for handling this in its LSP, so once you &lt;a href=&quot;https://github.com/OmniSharp/omnisharp-roslyn/issues/2250#issuecomment-1499726992&quot;&gt;enable it in the LSP capabilities&lt;/a&gt; the new-file-problem goes away!&lt;/p&gt;
&lt;pre class=&quot;language-lua&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;local&lt;/span&gt; capabilities &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vim&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;tbl_deep_extend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;force&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;cmp_nvim_lsp&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;default_capabilities&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        workspace &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            didChangeWatchedFiles &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                dynamicRegistration &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Upgrading Neovim, however, introduced a new problem. It seems like omnisharp-roslyn reports invalid tokens for the LSP semantic-highlighting feature, which trips up nvim. There’s a hacky workaround I’m using (that I found &lt;a href=&quot;https://nicolaiarocci.com/making-csharp-and-omnisharp-play-well-with-neovim/&quot;&gt;in a blog post&lt;/a&gt;) which manually fixes the invalid tokens; hopefully omnisharp fixes the issue upstream soon.&lt;/p&gt;
&lt;p&gt;That’s essentially where I’m leaving things for now: there are some hacks underlying my setup, but day-to-day everything works fine. I have a newfound appreciation for web dev tooling and the Rust project; this was definitely the most fiddly thing I’ve done with my editor in quite some time.&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Falling in love with git bisect</title>
      <link href="https://ryanisaacg.com/posts/git-bisect.html"/>
      <updated>2022-05-29T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/git-bisect.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Recently I found myself tracking down a handful of regressions: bugs I knew hadn’t existed just a week or two before. I vaguely knew that there was a git command that could help me, but I had never really put it to serious use. Now that I have used it, I find myself falling in love with &lt;code&gt;git bisect&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bisect&lt;/code&gt;, in the style of all things git, is slightly arcane and clunky but powerful nonetheless. All you have to do is tell git a known-good commit and a known-bad commit, and it will guide you through an efficient exploration of your repository’s history. At each step of the process, &lt;code&gt;bisect&lt;/code&gt; presents you with a commit and asks “is this commit good, or bad?” A quick test of your system and you can produce the answer (failing tests, incorrect behavior, broken build, what have you) and inform git; it can then continue with a binary search to find the offending change.&lt;/p&gt;
&lt;aside&gt;
&lt;p&gt;In case your runtime analysis skills are a little dusty, a binary search has an &lt;code&gt;O(log N)&lt;/code&gt; runtime to find its result. Even with 10,000 commits between your good and bad state, at most you’ll have to inspect 13 to find the culprit.&lt;/p&gt;
&lt;/aside&gt;
&lt;p&gt;You can initiate bisect with&lt;/p&gt;
&lt;p&gt;&lt;code&gt;git bisect start&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;At any time, you can bail out of this operation with&lt;/p&gt;
&lt;p&gt;&lt;code&gt;git bisect reset&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;which is good to keep in mind if you find yourself tangled. Now that you’ve started the bisect, define the bounds by picking a commit that has “good” state and a commit that has “bad” state:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;git bisect good my-good-commit&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;and&lt;/p&gt;
&lt;p&gt;&lt;code&gt;git bisect bad my-bad-commit&lt;/code&gt;&lt;/p&gt;
&lt;aside&gt;
&lt;p&gt;Git has introduced new aliases for &lt;code&gt;good&lt;/code&gt; and &lt;code&gt;bad&lt;/code&gt;: &lt;code&gt;new&lt;/code&gt; and &lt;code&gt;old&lt;/code&gt;, to allow for value-neutral bisects (like tracking down a performance improvement). I find &lt;code&gt;good&lt;/code&gt; and &lt;code&gt;bad&lt;/code&gt; to be much stronger pnuemonics, so I use them, but it’s good to know about the other options.&lt;/p&gt;
&lt;/aside&gt;
&lt;p&gt;After you’ve specified your commits, git will check out the midpoint and ask you to evaluate it. Do whatever you need (run tests, inspect an app, check benchmarks) and then inform git that this commit is &lt;code&gt;good&lt;/code&gt; or &lt;code&gt;bad&lt;/code&gt; with a simple &lt;code&gt;git bisect good/bad&lt;/code&gt; as desired. The process will repeat a few times until you find what you’re looking for!&lt;/p&gt;
&lt;p&gt;This is where we come to a crucial caveat: your git history. I find that it’s best to squash intermediary commits when merging, resulting in a clean list of working commits. It aids in history explorations like this one, and means you don’t have to fight through a flurry of “wip: temp” and “fix lint” garbage commits. However, if you find yourself confronted with a commit that you cannot test, &lt;code&gt;git bisect skip&lt;/code&gt; is your friend.&lt;/p&gt;
&lt;p&gt;If you’d like to learn more, the &lt;a href=&quot;https://git-scm.com/docs/git-bisect&quot;&gt;git bisect docs&lt;/a&gt; have more detail and even explore the topic of automatic bisecting. Happy hacking!&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Dark Mode!</title>
      <link href="https://ryanisaacg.com/posts/dark-mode.html"/>
      <updated>2021-04-04T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/dark-mode.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;If your browser is set to dark mode by default, you’ve probably noticed the site looks different! I now have some dark mode CSS, so this blog isn’t eye-searingly white if everything else is dark on your screen.&lt;/p&gt;
&lt;p&gt;Under the hood I’m using a neat CSS feature called &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties&quot;&gt;CSS variables&lt;/a&gt; to switch the colors.&lt;/p&gt;
&lt;p&gt;Unfortunately this means old posts with syntax highlighting have lost syntax highlighting, because setting up theme-specific highlights looked a little annoying. That’s not really a big deal to me, but I might fix it eventually.&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Quicksilver and Open Source</title>
      <link href="https://ryanisaacg.com/posts/quicksilver-goodbye.html"/>
      <updated>2020-10-13T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/quicksilver-goodbye.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;So this is a post that’s been bouncing around my head for a while, in one form or another. I created and maintain &lt;a href=&quot;https://github.com/ryanisaacg/quicksilver&quot;&gt;Quicksilver&lt;/a&gt;, a 2D game framework for creating games for desktop and the web. The reason I’m writing this post is that I also haven’t &lt;em&gt;used&lt;/em&gt; Quicksilver to make anything for over a year.&lt;/p&gt;
&lt;p&gt;TL;DR: Quicksilver has been a source of great joy and frustration for me, and was my first real experience with open source. I’m still committed to maintaining it, but I don’t think I’ll be actively improving or working on it going forward.&lt;/p&gt;
&lt;h2&gt;The Project’s Beginning&lt;/h2&gt;
&lt;aside&gt;
&lt;p&gt;What follows is a quick history of Quicksilver, and why I wanted to make it. I’ve never written it all down in one place before, and I figured now was a good opportunity. If you just want the details on what’s next, feel free to &lt;a href=&quot;https://ryanisaacg.com/posts/quicksilver-goodbye.html#so-long&quot;&gt;skip this section.&lt;/a&gt;&lt;/p&gt;
&lt;/aside&gt;
&lt;p&gt;From the start of my game-making hobby, I wanted a few things: to make small games, to be able to run them on low-powered hardware, and to be able to share them on the web. This was the beginning of my troubles.&lt;/p&gt;
&lt;p&gt;First I tried game engines, like GameMaker (which was actually my first programming environment), Unity, and later Godot. A few things about them frustrated me: the closed-source nature of Unity, Godot’s idiosyncratic custom scripting language (I understand this has improved), and being forced to lay my code out the way the engine wanted it. Ideally I would write the core of the gameplay code however I liked, and then add hooks to use for the engine tools. The paradigm of a game engine (a tool designed for teams, not soloists) wanted the opposite: everything should flow from the engine itself. To each their own, I guess.&lt;/p&gt;
&lt;p&gt;Game frameworks fared better, but inevitably something bothered me enough to switch. When I was using LibGDX and Java, distributing the Java binaries was a struggle. When I was using MonoGame and C#, cross-platform development on Linux was painful. Any dynamically typed programming language would eventually push me away after hours wasted tracking down a trivial bug. Even when I found a satisfactory programming language, often the game development ecosystem was sorely lacking (this is what drove me from D). And after all that, most game frameworks didn’t support sharing my game on the web.&lt;/p&gt;
&lt;p&gt;I tried developing for the web directly, rather than relying on translation layers or compilation steps. I made a few little things, but I never really could commit. This was before I was a web programmer by trade, so I spent a lot of time confused and annoyed. In the five or so years since Javascript has become a joy to use, as long as you’re willing to put up with byzantine build tools. Without these niceties I found it to be a pain; modularity didn’t exist (just link the script files into your HTML), odd typing decisions constantly bit me (did you know that the Canvas 2D API treats NaN as 0 when drawing?), and I missed something about having a native executable build I could email someone, and run with a single click.&lt;/p&gt;
&lt;p&gt;In mid-2017, Rust was where I finally settled, because it gave me two things: easy native-executable distribution, and a web compilation option. At the time, web compilation was unstable and no-one was really using it to make games; people who did tended to write bindings to the webpage by hand. Pulling in the venerable &lt;code&gt;glutin&lt;/code&gt; library for windowing on the desktop, I hand-wrote the Quicksilver-to-JS bindings for WebAssembly and got busy developing. It was buggy, it was a pain in the ass to use, and it was an absolute delight. Finally, native code running in the browser! I published my new library in the beginning of 2018, and slowly other people started to use it in their own work.&lt;/p&gt;
&lt;p&gt;Maintaining the JS bindings by hand was an absolute disaster. In June of 2018, I worked up the energy to switch to a library to handle the browser interactions for me. This was well before the &lt;code&gt;web-sys&lt;/code&gt; project, a comprehensive set of bindings to every browser API imaginable. When I was looking, I had two options. &lt;code&gt;stdweb&lt;/code&gt;, an ambitious project with plans to bind every single browser API to an idiomatic Rust wrapper, and &lt;code&gt;wasm-bindgen&lt;/code&gt;, a more efficient option with more maintainers, that required you to write the bindings yourself. I picked &lt;code&gt;stdweb&lt;/code&gt; for its ergonomics (much to my future dismay) and continued on, now with a much-improved workflow and a great deal more stability.&lt;/p&gt;
&lt;p&gt;At some point I realized things had to change. There were problems in the API maybe one in five new users would trip over, the backend graphics code was terrifying and unmaintainable, and &lt;code&gt;async/await&lt;/code&gt; was just around the corner. I could free myself and my users from callback hell! I set about plans for a major new API revision, and got to work. Over the summer of 2019 I laid the foundation for a set of new libraries, to abstract out the parts of Quicksilver that could live separately. By the end of the year they were pretty much all ready; over the course of Chanukah I put out a few blog updates describing them. The next big version of Quicksilver was in sight: all I had to do was re-write the entire thing to use my new foundational libraries.&lt;/p&gt;
&lt;p&gt;This year has not been a good year for progress. If I push myself, I can imagine in the next few months I could finish the API revision I started last year. Lots of things have contributed to this slowdown, and sapped my energy: a global pandemic, a move from a full-time student to a full-time worker, the worsening political situation in the United States. But I haven’t lost the energy to work on side projects entirely. I’m playing, running, and writing tabletop role-playing games, I’m reading more than I used to, and I’m playing around a little with some other hobby software. I just haven’t been making games, or using Quicksilver.&lt;/p&gt;
&lt;p&gt;The work that’s left isn’t particularly exciting either. I need to switch away from &lt;code&gt;stdweb&lt;/code&gt; (the maintainer seems to have silently disappeared), I need to write boatloads of documentation, I need to investigate and triage a handful of bug reports, and I need to write a library to support audio on desktop and web.&lt;/p&gt;
&lt;h2&gt;So Long…&lt;/h2&gt;
&lt;p&gt;To be frank, I didn’t get into open source to write software &lt;em&gt;for&lt;/em&gt; other people. If other people want software from me, they can pay me for it (which is quite literally my career). I got into open source because I was writing software for myself, and I figured other people might want to check it out. Sure, I &lt;em&gt;wanted&lt;/em&gt; people to check it out or use it. It felt great when people started using Quicksilver or posting bugs with projects they were working on. Out of all the game frameworks in the world, someone decided to use mine. How exciting!&lt;/p&gt;
&lt;p&gt;Over time my interests have drifted away from game development. I don’t keep up with the indie game scene, I don’t enter game jams, I don’t make little weekend projects. I’m not longer writing Quicksilver for myself, but I still work on it. For a while (most of last year, in fact), working on the framework was a hobby unto itself. I was solving fun new challenges, and it was great! As the fun new challenges got solved, I became less and less interested, and the things that had been tiny pain points before became less and less bearable.&lt;/p&gt;
&lt;p&gt;What makes it all worse is that Quicksilver will never be &lt;em&gt;done.&lt;/em&gt; There will always be one more feature, one more request, one more corner to polish. This summer, I was realizing that, and open source burnout was finally catching up with me. Every time I opened the issue tracker or my own notes I would feel dread, and close it without writing a line of code. The abstract idea of happy users was no longer enough to sustain me. I still haven’t even reached feature parity with the old, non-async version of Quicksilver, and I’m not sure I ever will.&lt;/p&gt;
&lt;p&gt;At some point it struck me: over three years, I had slowly moved from writing software that I was sharing with other people to writing software for other people. Unless things change, I don’t see myself writing more features for Quicksilver. I can’t promise sound support, or new documentation, or a smooth migration from &lt;code&gt;stdweb&lt;/code&gt; to &lt;code&gt;web-sys&lt;/code&gt;. If I can find the time and energy, I might package up the current alpha into an actual release, but I won’t promise that either.&lt;/p&gt;
&lt;p&gt;For now, I have no problem &lt;em&gt;maintaining&lt;/em&gt; software. I’ll be sticking around to triage bug reports, review pull requests, and cut releases (on Quicksilver, all its associated libraries, and Winit). Quicksilver isn’t going anywhere- but it’s important I make this explicit. It’s also not &lt;em&gt;going anywhere&lt;/em&gt;. I have no plans to fix the handful of outstanding bugs, or the feature requests, or upstream improvements to other projects.&lt;/p&gt;
&lt;p&gt;Here it is important to mention &lt;a href=&quot;https://en.wikipedia.org/wiki/Bus_factor&quot;&gt;the Bus Factor&lt;/a&gt;. Essentially: how many people have to get hit by a bus for your project to completely grind to a halt? In the case of Quicksilver, it has always been 1. Don’t get me wrong, other people have certainly contributed! Every well-crafted bug report or pull request has great value. At the end of the day, however, I’m still the single point of failure. That was never going to be a sustainable project structure, and I urge people to consider this concept in open source more generally.&lt;/p&gt;
&lt;h2&gt;…And Thanks for all the Fish&lt;/h2&gt;
&lt;p&gt;I don’t want to give the impression that I regret the project, or wish I hadn’t done it. Quicksilver was a great project for me to hold on to throughout my time as an undergraduate, and I hope it as brought other people a little bit of the joy it brought me. It couldn’t have gotten where it was without the Rust community; thank you to the 40 (!) other people who contributed commits, the countless people who filed bugs, and everyone who said kind things online. From the bottom of my heart: thank you.&lt;/p&gt;
&lt;p&gt;If you’re using Quicksilver and it works for you, rock on. If you’re looking for something else in light of this, I totally understand. For all the reasons mentioned above, I’m not really plugged in to what the best game-development alternatives are, though I’ve heard &lt;a href=&quot;https://github.com/bevyengine/bevy&quot;&gt;bevy&lt;/a&gt; is doing exciting new things.&lt;/p&gt;
&lt;p&gt;Good luck, have fun, and make great things.&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>A New Quicksilver Crate, Elefont</title>
      <link href="https://ryanisaacg.com/posts/announcing-elefont.html"/>
      <updated>2020-07-10T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/announcing-elefont.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;This blog post has been a long time delayed, but late is better than never! The Quicksilver alpha is humming along, with bugs and API problems being addressed. While that work continues, I want to unveil &lt;code&gt;elefont&lt;/code&gt;, a crate that I’ve developed for font caching.&lt;/p&gt;
&lt;h2&gt;What is Elefont?&lt;/h2&gt;
&lt;p&gt;Elefont is a glyph caching layer, intended to reduce round-trips to the GPU when rendering text.
When a glyph is sent to the GPU, it is stored on a texture and re-used until the cache needs to be refreshed.
Elefont is also designed to support many different font providers, and many different graphics backends: you can currently choose to render with &lt;a href=&quot;https://gitlab.redox-os.org/redox-os/rusttype&quot;&gt;rusttype&lt;/a&gt; or &lt;a href=&quot;https://github.com/mooman219/fontdue/&quot;&gt;fontdue&lt;/a&gt;, and there are plans to &lt;a href=&quot;https://github.com/ryanisaacg/elefont/issues/5&quot;&gt;support bitmap fonts&lt;/a&gt; and &lt;a href=&quot;https://github.com/ryanisaacg/elefont/issues/3&quot;&gt;operating-system-specific font toolkits via font_kit&lt;/a&gt;.
It is designed for use primarily in games, because it was written for Quicksilver, and the design reflects that. A GUI toolkit can probably choose a specific font rendering toolkit and use it throughout, but games tend to have more idiosyncratic text requirements (like bitmap fonts.)&lt;/p&gt;
&lt;h2&gt;What is Glyph Caching?&lt;/h2&gt;
&lt;p&gt;Glyph caching is an approach to font rendering that stores each “glyph” (font image) on the GPU.&lt;/p&gt;
&lt;aside&gt;
&lt;p&gt;Human writing is vast and complex, and so are the systems we have built to digitize it. A “glyph” is not the same as a “character;” this may surprise people who exclusively use Latin script. For example, Unicode emoji support &lt;a href=&quot;https://emojipedia.org/emoji-modifier-sequence/&quot;&gt;skin-tone modifiers&lt;/a&gt;. These are separate Unicode code-points that are placed &lt;em&gt;after&lt;/em&gt; the emoji code-point, and modify the image that is produced. Other familiar examples include all-caps fonts: ‘A’ and ‘a’ are different characters, but may be represented by the same glyph. For more on the complexity of text rendering, see &lt;a href=&quot;https://gankra.github.io/blah/text-hates-you/&quot;&gt;Text Rendering Hates You&lt;/a&gt;.&lt;/p&gt;
&lt;/aside&gt;
&lt;p&gt;Most fonts are stored in files like ‘TTF’ or ‘OTF’. These are called ‘vector fonts,’ because the glyphs are stored as a series of strokes; similar technology powers SVG images or Adobe Flash graphics. Every time you render a glyph from one of these fonts, the font system uses a ‘rasterizer’ to turn the strokes of the glyph into a grid of pixel color values. This is a fairly expensive operation, so glyph caches store this resulting bitmap instead of re-generating it every time the character is used. Elefont helps in this case by keeping track of a map of glyphs to their rendered counterparts.&lt;/p&gt;
&lt;p&gt;Even if you’re using a “bitmap font” (a font defined by pixel image data instead of vector graphics), you still have to send that image data to the GPU. With the machinery already in place to map from glyphs to rendered images, Elefont can help in this case by keeping track of a map of glyphs to their GPU-side counterparts. This is a high priority for a future version, but isn’t written yet.&lt;/p&gt;
&lt;h2&gt;Why not use X?&lt;/h2&gt;
&lt;p&gt;Initially, I didn’t expect to write Elefont or anything similar. I knew that Quicksilver 0.4 would need glyph caching, because fonts and text were a significant pain point in Quicksilver 0.3. What I did not find was anything that fit my requirements:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Work with any graphics backend. Quicksilver uses &lt;code&gt;golem&lt;/code&gt;, my abstraction layer over OpenGL, so being tied to another graphics library was a no-go&lt;/li&gt;
&lt;li&gt;Work with any font provider. Users may have bitmap fonts or vector fonts; they may want system-native font rendering (with some web fallback); they may want the more mature rusttype or the more ambitious fontdue, etc.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;There were other options that pass requirement 1, chief among them &lt;a href=&quot;https://crates.io/crates/glyph-brush&quot;&gt;glyph_brush&lt;/a&gt;. However, glyph_brush is tied into rusttype, and doesn’t seem to be interested in supporting bitmap fonts or other rasterizers. For many uses, glyph_brush is the right choice! However, it just couldn’t fit my needs. Bitmap fonts are a fairly common request when rendering for games, and a design that precludes them is a missed opportunity.&lt;/p&gt;
&lt;h2&gt;What Comes Next?&lt;/h2&gt;
&lt;p&gt;(Hopefully soon) I’ll be putting out a State of Quicksilver update, that generally addresses progress the project has made this year!&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Website Makeover, Again</title>
      <link href="https://ryanisaacg.com/posts/new-blog-2.html"/>
      <updated>2020-05-24T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/new-blog-2.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Out with the old, in with the new! After some frustration with Hugo, I’ve moved to &lt;a href=&quot;https://www.getzola.org/&quot;&gt;Zola&lt;/a&gt; and some light CSS.&lt;/p&gt;
&lt;p&gt;I wanted to write a new blog post regarding &lt;a href=&quot;https://github.com/ryanisaacg/elefont&quot;&gt;elefont&lt;/a&gt; and Quicksilver’s new text rendering system, but I  was dreading making a post on the site. Hugo had proved opaque and fragile for me, and its blizzard of configuration options wasn’t making things much easier. Plus, something small broke when I tried to use the latest Hugo version on Windows to re-build the site. I wasn’t much interested in tracking down a changelog and bringing my blog up to the latest version, so I decided Hugo had to go.&lt;/p&gt;
&lt;p&gt;Initially I considered writing my own static site generator. &lt;em&gt;How hard could it be?&lt;/em&gt; I asked myself. Then I thought about generating an RSS feed, and parsing front-matter, and maybe setting up a SASS compilation pipeline. &lt;em&gt;No thanks!&lt;/em&gt; I instead settled on Zola, primarily because it seems to be the right combination of simple and expressive. Secondarily, it’s written in Rust, which I appreciate. Using Zola has been very nice so far; I feel more like I’m programming a little language designed to make website-making easy. Previous experiences with Hugo and Jekyll felt more like wrestling the generator into doing what I wanted; Zola is a breath of fresh air by comparison.&lt;/p&gt;
&lt;p&gt;Currently the site is very light on styling. So far I like the look of it, but for how long is anyone’s guess.&lt;/p&gt;
&lt;p&gt;I hope this means I can get some posts up about Quicksilver soon; there’s been a lot of evolution since the end of last year, when I was just starting on the new alpha versions. I ended up forgoing a State of Quicksilver 2020, for a few reasons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019&quot;&gt;The Quicksilver Chanukah posts&lt;/a&gt; covered a lot of my plans&lt;/li&gt;
&lt;li&gt;I wanted to wait until the 0.4 release is closer to feature-complete&lt;/li&gt;
&lt;li&gt;And mostly, I’ve been very busy&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Post-script update, as of June 8th 2020: The blog is a bit more automatic! Previously I was just pushing up new built versions of the site to Github Pages, but that gets tedious. I set up Github Actions to run on any push to ryanisaacg/blog on master; now the blog is automatically built and deployed.&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>A Quicksilver Chanukah, Day 8: Rust Gamedev and the Web</title>
      <link href="https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-8.html"/>
      <updated>2019-12-29T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-8.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;This year has been great for Rust gamedev on the web. Huge progress has been made towards a full game stack being available more-or-less “for free:” most of the foundational crates have available web support, in one way or another.&lt;/p&gt;
&lt;h2&gt;Windowing and Input&lt;/h2&gt;
&lt;p&gt;For opening a window and receiving events from it, the Rust ecosystem has &lt;a href=&quot;https://github.com/rust-windowing/winit&quot;&gt;&lt;code&gt;winit&lt;/code&gt;&lt;/a&gt;. Along with &lt;a href=&quot;https://github.com/hecrj&quot;&gt;Héctor Ramón (hecrj)&lt;/a&gt; and and &lt;a href=&quot;https://github.com/blm768&quot;&gt;Ben Merritt (blm768)&lt;/a&gt;, I worked on adding web support. &lt;a href=&quot;https://users.rust-lang.org/t/winit-0-20-and-web-support/36155&quot;&gt;It has been merged and released&lt;/a&gt;, and is used in &lt;a href=&quot;https://github.com/hecrj/coffee&quot;&gt;coffee&lt;/a&gt; and &lt;a href=&quot;https://github.com/ryanisaacg/blinds&quot;&gt;blinds&lt;/a&gt;. While using &lt;code&gt;winit&lt;/code&gt; directly does require some glue code to plug your canvas into the webpage, intermediate layers like game frameworks can take care of the details.&lt;/p&gt;
&lt;p&gt;While &lt;code&gt;winit&lt;/code&gt; doesn’t currently provide gamepad events, &lt;a href=&quot;https://gitlab.com/gilrs-project/gilrs&quot;&gt;&lt;code&gt;gilrs&lt;/code&gt;&lt;/a&gt; fills that gap nicely. In the beginning of the year I added web support via stdweb, which should translate to &lt;code&gt;wasm-bindgen&lt;/code&gt; when necessary. Unlike &lt;code&gt;winit&lt;/code&gt;, which requires a little glue code to connect to your webpage, &lt;code&gt;gilrs&lt;/code&gt; Just Works. It functions nearly the same as the desktop version, with the only limitations being those the web platform imposes.&lt;/p&gt;
&lt;h2&gt;Graphics&lt;/h2&gt;
&lt;p&gt;When it comes to graphics on the web, there are two APIs to keep in mind. One is WebGL, which is the current way of writing graphics code for the web. The other is WebGPU, an evolving standard based on newer, more modern APIs that will be the way forward. Currently WebGPU is just in the draft phase, so we can’t target it just yet. Targeting WebGL directly is an option, but it seems like a waste to write OpenGL code for desktop and then again for web. Enter &lt;a href=&quot;https://github.com/grovesNL/glow&quot;&gt;&lt;code&gt;glow&lt;/code&gt;&lt;/a&gt;, which brings a unified API across destop and WebGL.&lt;/p&gt;
&lt;p&gt;Built on top of &lt;code&gt;glow&lt;/code&gt; is &lt;code&gt;gfx-backend-gl&lt;/code&gt;, which brings &lt;a href=&quot;https://github.com/gfx-rs/gfx&quot;&gt;&lt;code&gt;gfx-hal&lt;/code&gt;&lt;/a&gt; to desktop GL and web. By extension comes &lt;a href=&quot;https://github.com/gfx-rs/wgpu-rs&quot;&gt;&lt;code&gt;wgpu&lt;/code&gt;&lt;/a&gt;, an idiomatic Rust implementation of the upcoming WebGPU specification. It uses WebGL for now, but when WebGPU is stabilization and available, we’ll have a modern graphics API that works seamlessly across desktop and web.&lt;/p&gt;
&lt;h2&gt;Audio&lt;/h2&gt;
&lt;p&gt;The audio story for Rust on the web is not there yet, unfortunately. &lt;a href=&quot;https://github.com/RustAudio/cpal&quot;&gt;&lt;code&gt;cpal&lt;/code&gt;&lt;/a&gt;, a cross-platform library for Rust audio, doesn’t have web support yet. However, there is hope! &lt;a href=&quot;https://nannou.cc/posts/moss_grant_announce&quot;&gt;Mozilla announced a grant to Nannou&lt;/a&gt; that includes web support in &lt;code&gt;cpal&lt;/code&gt; as a core goal. The relevant issue is &lt;a href=&quot;https://github.com/RustAudio/cpal/issues/212&quot;&gt;cpal #212&lt;/a&gt;, which will hopefully yield some information early next year.&lt;/p&gt;
&lt;p&gt;That’s it for my updates! This was a good year for Rust on the web, and laid the groundwork for the changes I’ve talked about in Quicksilver. I’ll be back in the new year with a State of Quicksilver 2020, which should come along with an alpha release of the new Quicksilver version.&lt;/p&gt;
&lt;p&gt;If you’re interested in updates from other places in the Rust ecosystem, check out the &lt;a href=&quot;https://wiki.alopex.li/TheStateOfGGEZ2020&quot;&gt;State of GGEZ 2020&lt;/a&gt; and the &lt;a href=&quot;https://rust-gamedev.github.io/&quot;&gt;Rust Gamedev Working Group’s newsletters&lt;/a&gt;. See you in the new year!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/quicksilver-chanukah-2019&quot;&gt;The introduction post&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-2&quot;&gt;&lt;code&gt;platter&lt;/code&gt;: An async file-loading API for desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-3&quot;&gt;&lt;code&gt;gestalt&lt;/code&gt;: An API to manage bundling and saving data locally on desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-4&quot;&gt;&lt;code&gt;blinds&lt;/code&gt;: An easy-to-use async wrapper of &lt;code&gt;winit&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-5&quot;&gt;&lt;code&gt;golem&lt;/code&gt;: An opinionated mostly-safe graphics library for desktop and web GL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-6&quot;&gt;Changes to the Quicksilver application lifecycle&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-7&quot;&gt;Changes to the Quicksilver graphics API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;This post!&lt;/li&gt;
&lt;/ol&gt;
</content>
    </entry>
  
  
    <entry>
      <title>A Quicksilver Chanukah, Day 7: Quicksilver&#39;s New Graphics</title>
      <link href="https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-7.html"/>
      <updated>2019-12-28T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-7.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;The graphics API of Quicksilver isn’t as dire need of a rework as the &lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-6&quot;&gt;lifecycle APIs&lt;/a&gt;, but I wanted to take the next breaking change as an opportunity to address some long-standing issues.&lt;/p&gt;
&lt;p&gt;In no particular order, they are:&lt;/p&gt;
&lt;h2&gt;Low-Level Access&lt;/h2&gt;
&lt;p&gt;As it stands, Quicksilver talks to a very specific backend design for graphics. The API is internal-only and designed to wrap up all the GL code in one place, to keep the high-level drawing APIs platform independent. There’s no way to expose the raw GL API directly to the user, as the backend talks directly to OpenGL 3.2 and WebGL 1. With &lt;code&gt;glow&lt;/code&gt;, we could expose a cross-platform OpenGL context, but there are still differences between desktop and web GL. These problems, like different ways of describing the input and output in GLSL, are addressed by &lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-5&quot;&gt;&lt;code&gt;golem&lt;/code&gt; (see announcement from 2 days ago.)&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Providing users access to a lower-level graphics API also frees the high-level API from trying to provide custom shader support. A custom shader is best served with custom vertex inputs, which means custom functions to turn high-level draw commands into low-level vertex data. Instead of trying to solve this problem in the general case, Quicksilver can provide the mechanism to solve it yourself.&lt;/p&gt;
&lt;h2&gt;Draw Order&lt;/h2&gt;
&lt;p&gt;The previous graphics API aggressively batches draws, including re-ordering &lt;code&gt;draw&lt;/code&gt; commands to avoid changing state while rendering. If a &lt;code&gt;z&lt;/code&gt; parameter (not included in the default, simple &lt;code&gt;draw&lt;/code&gt;) is not provided, anything goes. Hypothetically this leads to faster rendering, but it also means that many users experience unexpected results with basic operations. The new API should be built on a simple draw-order guarantee: the first draw call is drawn furthest back, with each subsequent draw lying on top of the ones before it.&lt;/p&gt;
&lt;h2&gt;Render-To-Texture&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;Surface&lt;/code&gt; API supports render-to-texture, but it has a few problems. First, the API is unintuitive: rendering to a texture only works within a closure, for example. Also, it’s plain buggy. &lt;code&gt;golem&lt;/code&gt; provides a harder-to-misuse API for off-screen rendering, which can be used to build a nicer abstraction in Quicksilver itself.&lt;/p&gt;
&lt;h2&gt;Screen Resizing and Projection&lt;/h2&gt;
&lt;p&gt;The current version of Quicksilver “magically” handles the window being resized, as well as projecting and unprojecting between world and screen coordinates. Often this is more trouble than it’s worth: you want your UI at one projection and letterbox, and your game content at another. By exposing a few more knobs to the user (like the GL viewport), the &lt;code&gt;ResizeStrategy&lt;/code&gt; API can be provided on top of other, orthogonal abstractions.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019&quot;&gt;The introduction post&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-2&quot;&gt;&lt;code&gt;platter&lt;/code&gt;: An async file-loading API for desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-3&quot;&gt;&lt;code&gt;gestalt&lt;/code&gt;: An API to manage bundling and saving data locally on desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-4&quot;&gt;&lt;code&gt;blinds&lt;/code&gt;: An easy-to-use async wrapper of &lt;code&gt;winit&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-5&quot;&gt;&lt;code&gt;golem&lt;/code&gt;: An opinionated mostly-safe graphics library for desktop and web GL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-6&quot;&gt;Changes to the Quicksilver application lifecycle&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;This post!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-8&quot;&gt;An overview of the work on web support this year&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</content>
    </entry>
  
  
    <entry>
      <title>A Quicksilver Chanukah, Day 6: Quicksilver&#39;s New Lifecycle</title>
      <link href="https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-6.html"/>
      <updated>2019-12-27T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-6.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Quicksilver has always had some major API compromises to deliver on its core promise: write a game once, and it targets desktop and the web with no changes. The two ugliest compromises are the &lt;code&gt;State&lt;/code&gt; and &lt;code&gt;Asset&lt;/code&gt; APIs, for managing your application’s core loop and file loading, respectively.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;State&lt;/code&gt; is a trait that Quicksilver uses to manage when your code runs. It requires you define the &lt;code&gt;new&lt;/code&gt; method, as well as &lt;code&gt;draw&lt;/code&gt;. Optionally you can define &lt;code&gt;update&lt;/code&gt;, for a fixed tick rate function, and &lt;code&gt;event&lt;/code&gt; for handling individual input events. This type then gets passed as a generic parameter to the &lt;code&gt;run&lt;/code&gt; function, which handles instantiating it and running the event loop. The downside is that the user gets very little say in how their code is arranged, but the benefit is that your code runs on web without blocking the main thread (which will lock up the tab.)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Asset&lt;/code&gt; is a wrapper around &lt;code&gt;Future&lt;/code&gt;, which is an asychronous action in Rust. The point of the &lt;code&gt;Asset&lt;/code&gt; API was to avoid users having to manually poll their futures to check if they’re ready: just use an &lt;code&gt;Asset&lt;/code&gt; and its execute method, which will run a closure if its &lt;code&gt;Future&lt;/code&gt; is completed. Unfortunately, this turns out not to be very ergonomic. &lt;code&gt;Asset&lt;/code&gt; is a pain to use, and a point of confusion for most users. There’s no way around asychronous file loading on the web, but new developments in Rust have made much better solutions possible.&lt;/p&gt;
&lt;p&gt;Readers of previous posts may notice that these two API problems are addressed by two of the crates I announced this week: &lt;code&gt;blinds&lt;/code&gt; to address &lt;code&gt;State&lt;/code&gt; and &lt;code&gt;platter&lt;/code&gt; to address &lt;code&gt;Asset&lt;/code&gt;. Where before, you might write something like:&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token type-definition class-name&quot;&gt;MyState&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    images&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Asset&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    game&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Game&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;State&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyState&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyState&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;MyState&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            images&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Asset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;join_all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;vec!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;b&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;c&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            game&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Game&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _win&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Window&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ev&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;images&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token closure-params&quot;&gt;&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;images&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;game&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;process_event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ev&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; _win&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Window&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;images&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token closure-params&quot;&gt;&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;images&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;game&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;draw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; win&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Window&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;images&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token closure-params&quot;&gt;&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;images&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;game&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;draw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;images&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; win&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MyState&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;you could now write something like:&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;my_game&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;win&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Window&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; gfx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Graphics&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; events&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EventStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; game &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Game&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; images &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;join_all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token macro property&quot;&gt;vec!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;b&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;c&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ev&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; events&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next_event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            game&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;process_event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ev&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        game&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        game&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;draw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; gfx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        gfx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;present&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;win&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;my_game&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If you want to know more, check out &lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-4&quot;&gt;my post about blinds&lt;/a&gt; for more details on the event loop and &lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-2&quot;&gt;my post about platter&lt;/a&gt; for more details on async file loading.&lt;/p&gt;
&lt;p&gt;As a side effect of the async API, the user has a lot more control over when their code runs. Previously Quicksilver managed your update timing automatically: it would aim for 60Hz by default, regardless of how long updates take. Now you’re in charge of your own timing, though features to make timing fire-and-forget could become part of the final release.&lt;/p&gt;
&lt;p&gt;Speaking of releases, I hope to have a very early alpha of this version of Quicksilver out within the next week or so. It will be a very bare-bones version: just the event loop and some small graphics functions for now, which I’ll go into more depth about tomorrow.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019&quot;&gt;The introduction post&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-2&quot;&gt;&lt;code&gt;platter&lt;/code&gt;: An async file-loading API for desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-3&quot;&gt;&lt;code&gt;gestalt&lt;/code&gt;: An API to manage bundling and saving data locally on desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-4&quot;&gt;&lt;code&gt;blinds&lt;/code&gt;: An easy-to-use async wrapper of &lt;code&gt;winit&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-5&quot;&gt;&lt;code&gt;golem&lt;/code&gt;: An opinionated mostly-safe graphics library for desktop and web GL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;This post!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-7&quot;&gt;Changes to the Quicksilver graphics API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-8&quot;&gt;An overview of the work on web support this year&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</content>
    </entry>
  
  
    <entry>
      <title>A Quicksilver Chanukah, Day 5: Golem</title>
      <link href="https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-5.html"/>
      <updated>2019-12-26T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-5.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;&lt;code&gt;golem&lt;/code&gt; is a mostly-safe graphics API that targets OpenGL 3.2 and WebGL 1 that helps make writing GL less painful.&lt;/p&gt;
&lt;h2&gt;Why &lt;code&gt;golem&lt;/code&gt; and not X&lt;/h2&gt;
&lt;p&gt;If you’re just interested in what &lt;code&gt;golem&lt;/code&gt; is and how it works, feel free to skip this section!&lt;/p&gt;
&lt;p&gt;The previous three days I’ve introduced new crates that mostly stood on their own. I’m not aware of any fleshed-out alternatives, so creating those libraries myself doesn’t require much explanation. &lt;code&gt;golem&lt;/code&gt;, however, is a different story: there aren’t exactly a shortage of Rust graphics libraries. There are a variety of reasons as to why none of them fit Quicksilver’s needs, most of which revolve around support for older hardware or older APIs. For brevity, I’d recommend you check out &lt;a href=&quot;https://wiki.alopex.li/AGuideToRustGraphicsLibraries2019&quot;&gt;icefox’s guide to the existing graphics options&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I have a test device that I think is a good benchmark for something Quicksilver-powered games should be able to target, and it doesn’t support Vulkan. This eliminates &lt;code&gt;ash&lt;/code&gt; and &lt;code&gt;vulkano&lt;/code&gt; straight off the bat, and &lt;code&gt;gfx-hal&lt;/code&gt; as well. &lt;code&gt;ash&lt;/code&gt; and &lt;code&gt;vulkano&lt;/code&gt; target Vulkan directly, and &lt;code&gt;gfx-hal&lt;/code&gt;’s OpenGL backend is not currently reliable enough (though I hope to see that improve!)&lt;/p&gt;
&lt;p&gt;I also want to be able to support WebGL 1, but WebGL 1 is not a very modern version of OpenGL. This makes it, for good reaon, unattractive to other libraries (like &lt;code&gt;luminance&lt;/code&gt;, which is targeting WebGL 2 in its upcoming web support). However, WebGL 2’s &lt;a href=&quot;https://caniuse.com/#feat=webgl2&quot;&gt;market share&lt;/a&gt; still hovers at around 75%, which isn’t ideal; notably missing from WebGL 2 support are the current verisons of Edge, Safari, and iOS Safari. Quicksilver recently transitioned to using WebGL 1 for better platform support, and I didn’t want to regress by requiring a high version. This rules out &lt;code&gt;luminance&lt;/code&gt;, and presumably &lt;code&gt;glium&lt;/code&gt; (which has no current development towards web support as far as I’m aware.)&lt;/p&gt;
&lt;p&gt;With just those two constraints I’m out of options, so I decided to write &lt;code&gt;golem&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Mostly-Safe?&lt;/h2&gt;
&lt;p&gt;Where possible, &lt;code&gt;golem&lt;/code&gt; handles for you the complex state machine of OpenGL. In other places, it prevents you from using resources that haven’t been properly set-up. In these cases, &lt;code&gt;golem&lt;/code&gt; is safe with low-overhead, removing footguns from OpenGL without slowing your code down. In others, more overhead would be required to keep the API free of &lt;code&gt;unsafe&lt;/code&gt;. Currently only two functions are marked as &lt;code&gt;unsafe&lt;/code&gt; in &lt;code&gt;golem&lt;/code&gt;’s public API, but they are the only functions that draw things to the screen! This means using &lt;code&gt;unsafe&lt;/code&gt; code as a consumer of &lt;code&gt;golem&lt;/code&gt; is unavoidable, hence “mostly-safe.”&lt;/p&gt;
&lt;h2&gt;A Code Snippet&lt;/h2&gt;
&lt;p&gt;Hopefully if you’re familiar with graphics APIs, this code snippet to draw a triangle to the screen will look a little familiar. If not, the comments should help you follow along!&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;blinds&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;golem&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Attribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AttributeType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Dimension&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;D2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;D4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ElementBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GeometryMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GolemError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShaderDescription&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShaderProgram&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;VertexBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// The application loop, powered by the blinds crate&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    window&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Window&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    ctx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;glow&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; events&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EventStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GolemError&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Create a context from &#39;glow&#39;, GL On Whatever&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ctx &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from_glow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token attribute attr-name&quot;&gt;#[rustfmt::skip]&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// This is the data that represents the triangle&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// It&#39;s arranged how it will be passed to the GPU: each position represented as two f32 values,&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// followed by each color represented as 4 f32 values. The positions are on a scale from -1.0&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// to 1.0, which represents the viewport in OpenGL. The colors are represented as R, G, B, A,&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// on a scale from 0.0 to 1.0&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; vertices &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Position         Color&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token number&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;          &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;           &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// This is the data that indicates how to draw the vertices&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// For a simple example of one triangle, we don&#39;t gain much from this. Any order of these three&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// points will give us the same triangle. However, if we add more points (to draw a square, for&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// example), then we can write each point once while using it in multiple triangles.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; indices &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Here we create the ShaderProgram, which is some code that runs on the GPU. It determines how&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// to turn our vertex data into an actual vertex that GL understands, and how to color each&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// &#39;fragment&#39; (essentially a pixel). These are each their own little program, where the&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// information from the vertex shader is fed into the fragment shader.&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// For the purposes of making sure the shaders match, and for ensuring compatibility on desktop&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// and web, the inputs are represented as data structures and then converted to shader&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// declarations at runtime.&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// The input to the shader program is fed to the vertex_input, so your vertex data&#39;s format&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// needs to match what you define in vertex_input&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; shader &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShaderProgram&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        ctx&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;ShaderDescription&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// Take in to the shader a position (as a vector with 2 components) and a color (as a&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// vector with 4 components). This is the same format as &#39;vertices&#39; above&lt;/span&gt;
            vertex_input&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;Attribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;vert_position&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AttributeType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;D2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;Attribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;vert_color&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AttributeType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;D4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// Pass to the fragment shader the color&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// OpenGL will actually smoothly interpolate between different vertex values for us, so&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// a red vertex and a blue vertex will have a gradient between them&lt;/span&gt;
            fragment_input&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Attribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;frag_color&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AttributeType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;D4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// Uniforms represent a value that&#39;s the same for the entire shader; we don&#39;t need any&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// here. If you&#39;re rendering images or applying transformations to your entire draw&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// call, use uniforms!&lt;/span&gt;
            uniforms&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// A program written in GLSL that uses the inputs and outputs defined above&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// There&#39;s also a hard-coded output called gl_Position&lt;/span&gt;
            vertex_shader&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;r#&quot; void main() {
            gl_Position = vec4(vert_position, 0, 1);
            frag_color = vert_color;
        }&quot;#&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// The fragment shader has a hard-coded output: gl_FragColor&lt;/span&gt;
            fragment_shader&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;r#&quot; void main() {
            gl_FragColor = frag_color;
        }&quot;#&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Create buffer objects, which we use to transfer data from the CPU to the GPU&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; vb &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;VertexBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; eb &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ElementBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ctx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Set the data of the buffer to be our vertices and indices from earlier&lt;/span&gt;
    vb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set_data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;vertices&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    eb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set_data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;indices&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Prepare the shader for operations: shaders will raise errors if you forget to bind them&lt;/span&gt;
    shader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Clear the screen&lt;/span&gt;
    ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;unsafe&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Using our buffers, draw our triangle&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// We could also interpert our indices as Lines or a variety of other shape options:&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// nothing binds us to necessarily using Triangles, even though they&#39;re the most common&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// shape in graphics&lt;/span&gt;
        shader&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;draw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;vb&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;eb&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;indices&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GeometryMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Triangles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Show our data to the window&lt;/span&gt;
    window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;present&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Keep the window open and responsive until the user exits&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        events&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next_event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Run our application!&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;run_gl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Settings&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token closure-params&quot;&gt;&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; gfx&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; events&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;move&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; gfx&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; events&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unwrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(This is also an example of &lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-4&quot;&gt;yesterday’s &lt;code&gt;blinds&lt;/code&gt;&lt;/a&gt; and its OpenGL support.)&lt;/p&gt;
&lt;h2&gt;Further Development&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;golem&lt;/code&gt; is not intended to be a fully-featured wrapper around all of OpenGL. It’s intended to be enough to write fairly complex 2D graphics, or fairly simple 3D graphics. That said, there is a lot that’s missing! Some of it is documented on the &lt;a href=&quot;https://github.com/ryanisaacg/golem/issues&quot;&gt;issue tracker&lt;/a&gt;, but I’m sure that I’ve missed other things. Nearly everything I need for Quicksilver is done, but your use case might be different. Feel free to open an issue discussing a feature addition, or try and experiment with a fork for larger changes.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;golem&lt;/code&gt; is the last new crate to announce, which means tomorrow is about what these crates enable: the new version of Quicksilver.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019&quot;&gt;The introduction post&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-2&quot;&gt;&lt;code&gt;platter&lt;/code&gt;: An async file-loading API for desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-3&quot;&gt;&lt;code&gt;gestalt&lt;/code&gt;: An API to manage bundling and saving data locally on desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-4&quot;&gt;&lt;code&gt;blinds&lt;/code&gt;: An easy-to-use async wrapper of &lt;code&gt;winit&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;This post!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-6&quot;&gt;Changes to the Quicksilver application lifecycle&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-7&quot;&gt;Changes to the Quicksilver graphics API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-8&quot;&gt;An overview of the work on web support this year&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</content>
    </entry>
  
  
    <entry>
      <title>A Quicksilver Chanukah, Day 4: Blinds</title>
      <link href="https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-4.html"/>
      <updated>2019-12-25T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-4.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;With the recent update to &lt;a href=&quot;https://github.com/rust-windowing/winit&quot;&gt;&lt;code&gt;winit&lt;/code&gt;&lt;/a&gt;, it gained web support! This is great, and it means that Quicksilver doesn’t need to have its own parallel implementation of windowing. However, there is room for an abstraction that’s a little simpler than Winit, and takes advantage of &lt;code&gt;async/.await&lt;/code&gt;, which is where &lt;a href=&quot;https://crates.io/crates/blinds&quot;&gt;&lt;code&gt;blinds&lt;/code&gt;&lt;/a&gt; comes in.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;blinds&lt;/code&gt; is based on &lt;code&gt;winit&lt;/code&gt;, but focused on Quicksilver’s specific use case of single-window games on desktop and web. It also integrates &lt;code&gt;gilrs&lt;/code&gt; for gamepad support (though this could be provided directly by &lt;code&gt;winit&lt;/code&gt; later), without exposing either in its external API. Additionally, &lt;code&gt;blinds&lt;/code&gt; has optional support for OpenGL, via &lt;code&gt;glow&lt;/code&gt; for uniform bindings across web and desktop.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;async&lt;/code&gt; API works via the &lt;code&gt;LocalPool&lt;/code&gt; and the &lt;code&gt;winit&lt;/code&gt; event loop, allowing you to write code that &lt;em&gt;almost&lt;/em&gt; looks like a synchronous event loop.&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;blinds&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EventStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Settings&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Window&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Settings&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; app&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_window&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Window&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; events&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EventStream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Some&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ev&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; events&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;next_event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// Process your events here!&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Process your frame here!&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The use of &lt;code&gt;.await&lt;/code&gt; here is a bit of a hack, as it allows the event loop to wrest control away from the user and return it to the browser without blocking. Compare this to the comparable snippet from the legacy Quicksilver API:&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;quicksilver&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token namespace&quot;&gt;geom&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token namespace&quot;&gt;lifecycle&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Settings&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;State&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Window&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; run&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token type-definition class-name&quot;&gt;HelloWorld&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;impl&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;State&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HelloWorld&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HelloWorld&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HelloWorld&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; window&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Window&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Process events here&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; window&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Window&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Update here&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;draw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; window&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Window&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Draw here&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Ok&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function-definition function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;HelloWorld&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello World&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;800&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;600&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Settings&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The &lt;code&gt;async&lt;/code&gt; API isn’t just way more convenient than the previous, trait-based system. It also allows you to use other &lt;code&gt;async&lt;/code&gt; APIs (like &lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-2&quot;&gt;day 2’s &lt;code&gt;platter&lt;/code&gt;&lt;/a&gt;), which is important for web support.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;blinds&lt;/code&gt; isn’t quite ready for a full release yet: there are a few more window APIs I do want to expose before it leaves alpha. However, you can still try it out, just be aware that the API is fairly unstable and likely to change between multiple times before the first non-alpha release!&lt;/p&gt;
&lt;p&gt;With &lt;code&gt;blinds&lt;/code&gt; today, tomorrow will be the last new crate: &lt;code&gt;golem&lt;/code&gt;!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019&quot;&gt;The introduction post&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-2&quot;&gt;&lt;code&gt;platter&lt;/code&gt;: An async file-loading API for desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-3&quot;&gt;&lt;code&gt;gestalt&lt;/code&gt;: An API to manage bundling and saving data locally on desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;This post!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-5&quot;&gt;&lt;code&gt;golem&lt;/code&gt;: An opinionated mostly-safe graphics library for desktop and web GL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-6&quot;&gt;Changes to the Quicksilver application lifecycle&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-7&quot;&gt;Changes to the Quicksilver graphics API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-8&quot;&gt;An overview of the work on web support this year&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</content>
    </entry>
  
  
    <entry>
      <title>A Quicksilver Chanukah, Day 3: Gestalt</title>
      <link href="https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-3.html"/>
      <updated>2019-12-24T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-3.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;Often your application might want to store gamestate or configurations, but the web has no filesystem access. Additionally, you don’t want to just dump files in the user’s home directory; each desktop operating system has a different preferred location for storing application-specific data, and often different locations for different kinds of data.&lt;/p&gt;
&lt;p&gt;Introducing &lt;a href=&quot;https://crates.io/crates/gestalt&quot;&gt;&lt;code&gt;gestalt&lt;/code&gt;&lt;/a&gt;, a library that bundles up your data and stores it away so you don’t have to.&lt;/p&gt;
&lt;p&gt;A sample to save some game state:&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;gestalt&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Location&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; save&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; load&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;serde&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Serialize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Deserialize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(Serialize, Deserialize)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token type-definition class-name&quot;&gt;Player&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    score&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;u32&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; player1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Player&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Bob&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;to_string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; score&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Location&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mygame&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;player1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;player1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Could not save Player 1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; player2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Player&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Alice&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;to_string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; score&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Location&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mygame&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;player2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;player2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Could not save Player 2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Now reload.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; player1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Player&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Location&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mygame&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;player1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Could not load Player 1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; player2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Player&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Location&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mygame&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;player2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Could not load Player 2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Getsalt creates a Key/Value store, backed by the filesystem on desktop and the web storage API. The key is formed by &lt;code&gt;Location&lt;/code&gt;, which determines the kind of data (&lt;code&gt;Location::Cache&lt;/code&gt;, &lt;code&gt;Location::Data&lt;/code&gt;, and &lt;code&gt;Location::Config&lt;/code&gt;), the application name, and a string which identifies the name of the data chunk. The value is anything that implements &lt;code&gt;Serialize&lt;/code&gt; from &lt;a href=&quot;https://crates.io/crates/serde&quot;&gt;&lt;code&gt;serde&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Cache&lt;/code&gt; is for data that can be cleared between runs of your application; &lt;code&gt;Data&lt;/code&gt; is for blobs like save states, and &lt;code&gt;Config&lt;/code&gt; is for application settings. &lt;code&gt;gestalt&lt;/code&gt; uses &lt;a href=&quot;https://crates.io/crates/dirs&quot;&gt;&lt;code&gt;dirs&lt;/code&gt;&lt;/a&gt; to ensure that it saves your data in the right place for each, regardless of your user’s operating system.&lt;/p&gt;
&lt;p&gt;That’s Day 3 done: &lt;code&gt;gestalt&lt;/code&gt; is pretty small! Tomorrow’s library, &lt;code&gt;blinds&lt;/code&gt;, starts to get quite a bit bigger.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019&quot;&gt;The introduction post&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-2&quot;&gt;&lt;code&gt;platter&lt;/code&gt;: An async file-loading API for desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;This post!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-4&quot;&gt;&lt;code&gt;blinds&lt;/code&gt;: An easy-to-use async wrapper of &lt;code&gt;winit&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-5&quot;&gt;&lt;code&gt;golem&lt;/code&gt;: An opinionated mostly-safe graphics library for desktop and web GL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-6&quot;&gt;Changes to the Quicksilver application lifecycle&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-7&quot;&gt;Changes to the Quicksilver graphics API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-8&quot;&gt;An overview of the work on web support this year&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</content>
    </entry>
  
  
    <entry>
      <title>A Quicksilver Chanukah, Day 2: Platter</title>
      <link href="https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-2.html"/>
      <updated>2019-12-23T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/quicksilver-chanukah-2019-day-2.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;This year saw the release of &lt;code&gt;async/.await&lt;/code&gt; in stable Rust, marking a huge change in how asynchronous code is written. Previously, one would have to chain a series of combinators onto a &lt;code&gt;Future&lt;/code&gt; instance to accomplish asyncrhonous tasks. In Quicksilver, this was used for asset loading (for compatibility with the web backend), and has been a frequent source of pain.&lt;/p&gt;
&lt;p&gt;Something as simple as loading a file, reading its contents, and loading a series of images based on those contents might look like this psuedo-Rust:&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; images&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;load_file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;my_manifest_path&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;parse_file_contents&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;and_then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token closure-params&quot;&gt;&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;image_paths&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;join_all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        image_paths
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;load_file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token closure-params&quot;&gt;&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;file&lt;span class=&quot;token closure-punctuation punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt; file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;and_then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;parse_image&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;render_loading&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Core application loop&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; images&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;is_ready &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;render_frame&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;images&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This is fairly hard to read, and requires a bit of domain-specific knowledge of the combinators to achieve it. Worse still is introducing more than one of these combinator chains, and trying to execute game logic only if they complete. This snippet is plenty complex, and hasn’t even touched error handling.&lt;/p&gt;
&lt;p&gt;Introducing &lt;a href=&quot;https://crates.io/crates/platter&quot;&gt;&lt;code&gt;platter&lt;/code&gt;&lt;/a&gt;, a new async-enabled crate with a single, simple task: load files on desktop and web with an easy API.&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token function&quot;&gt;render_loading&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; contents&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;load_file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;my_manifest_path&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; image_paths&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;parse_file_contents&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;contents&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; images&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; image_path &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; image_paths &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; image_file&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;load_file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;image_path&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    images&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;parse_image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;image_file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;render_frame&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;images&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can still make use of the combinators in a more functional-programming style if we wish, but now it’s much clearer:&lt;/p&gt;
&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token function&quot;&gt;render_loading&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; contents&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;load_file&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;my_manifest_path&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; image_futures&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;parse_file_contents&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;contents&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;load_file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; images&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vec&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;try_join_all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;image_futures&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;parse_image&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;collect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;render_frame&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;images&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;platter&lt;/code&gt; is small and can be plugged into your own game framework or game project if you want to harness &lt;code&gt;async/await&lt;/code&gt; to load files on desktop and web. It will be a major part of the new Quicksilver application lifecyle!&lt;/p&gt;
&lt;p&gt;That’s Day 2 down, but there are 6 more days of Quicksilver Chanukah:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019&quot;&gt;Yesterday’s introduction post&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;This post!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-3&quot;&gt;&lt;code&gt;gestalt&lt;/code&gt;: An API to manage bundling and saving data locally on desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-4&quot;&gt;&lt;code&gt;blinds&lt;/code&gt;: An easy-to-use async wrapper of &lt;code&gt;winit&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-5&quot;&gt;&lt;code&gt;golem&lt;/code&gt;: An opinionated mostly-safe graphics library for desktop and web GL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-6&quot;&gt;Changes to the Quicksilver application lifecycle&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-7&quot;&gt;Changes to the Quicksilver graphics API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-8&quot;&gt;An overview of the work on web support this year&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</content>
    </entry>
  
  
    <entry>
      <title>A Quicksilver Chanukah: Day 1</title>
      <link href="https://ryanisaacg.com/posts/quicksilver-chanukah-2019.html"/>
      <updated>2019-12-22T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/quicksilver-chanukah-2019.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;I started this year with a &lt;a href=&quot;https://ryanisaacg.com/state-of-quicksilver-feb-2019&quot;&gt;blog post about the state of Quicksilver&lt;/a&gt; where I set a goal for myself: get web support for important game development crates upstreamed. At the end of the year, I’m happy to update this work (by me and many others!) has been a success, and the core of Rust’s game ecosystem is now-web enabled. In the future, I want to write a brief overview of those changes, but for now I want to focus on their relevance to Quicksilver.&lt;/p&gt;
&lt;p&gt;Without having to maintain my own set of web bindings for Quicksilver, I was able to start working on significant changes to both the internal and external structure. There are a few entirely unrelated modules in Quicksilver that are all needed for the framework: handling filesystem resources, creating and loading local data, the event loop, the graphics API, and the sound API. It makes sense to allow users to pick and choose these systems, which is the goal of Quicksilver’s optional features. However, that still requires depending on Quicksilver, which doesn’t make sense for some projects. Instead, I’ve created a few new crates that anyone can drop into their project without pulling in any other Quicksilver-related code.&lt;/p&gt;
&lt;p&gt;Additionally, a major new Rust feature landed this year: async/await. Quicksilver’s asset loading system has been a sticking point, because of its design decisions and the inherent pain of combinator-based &lt;code&gt;Future&lt;/code&gt; code. With &lt;code&gt;async&lt;/code&gt; and &lt;code&gt;.await&lt;/code&gt;, a new asynchronous asset loading API can be almost seamless. Combined with fixes to long-standing graphics API problems, I’ve been working on a new major release for Quicksilver (which will be the first breaking change in over a year.)&lt;/p&gt;
&lt;p&gt;As &lt;a href=&quot;https://en.wikipedia.org/wiki/Hanukkah&quot;&gt;Chanukah&lt;/a&gt; starts tonight, I’m going to share these new crates and big Quicksilver updates over the next eight days. I can’t promise I’ll actually stick to this schedule, but my goal is:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;This post!&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-2&quot;&gt;&lt;code&gt;platter&lt;/code&gt;: An async file-loading API for desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-3&quot;&gt;&lt;code&gt;gestalt&lt;/code&gt;: An API to manage bundling and saving data locally on desktop and web&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-4&quot;&gt;&lt;code&gt;blinds&lt;/code&gt;: An easy-to-use async wrapper of &lt;code&gt;winit&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-5&quot;&gt;&lt;code&gt;golem&lt;/code&gt;: An opinionated mostly-safe graphics library for desktop and web GL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-6&quot;&gt;Changes to the Quicksilver application lifecycle&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-7&quot;&gt;Changes to the Quicksilver graphics API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://ryanisaacg.com/quicksilver-chanukah-2019-day-8&quot;&gt;An overview of the work on web support this year&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</content>
    </entry>
  
  
    <entry>
      <title>Website Makeover</title>
      <link href="https://ryanisaacg.com/posts/new-blog-debut.html"/>
      <updated>2019-07-20T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/new-blog-debut.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;So www.ryanisaacg.com has a very new look, powered by Hugo and my (fairly small) fork of the &lt;a href=&quot;https://github.com/rhazdon/hugo-theme-hello-friend-ng&quot;&gt;hello-friend-ng&lt;/a&gt; theme.&lt;/p&gt;
&lt;p&gt;Partly the site will be dedicated to a bit of a professional showcase / bio for myself, but also with added blog functionality I can communicate in a more public way about my plans for my open source projects.&lt;/p&gt;
&lt;p&gt;The State of Quicksilver that I wrote earlier this year has moved from its previous home as Github gist to retroactively being a post here, as I feel more comfortable linking to my writing in a domain that I control and can ensure the links stay live. The Quicksilver website itself is still hosted within the Quicksilver repo, partially for ease of version control (if a commit changes code, it can change the website docs in lockstep) and partially because I’m not sure how much I want to present Quicksilver as being &lt;em&gt;my project&lt;/em&gt; versus the &lt;em&gt;Quicksilver project&lt;/em&gt;. I’m too cheap and lazy to buy a quicksilver domain, so the URL still contains my screen name, but the website is independent of the rest of ryanisaacg.com. Future State-Of-Quicksilver posts will also live on this blog though, as my personal plans for the project and my work for the Rust ecosystem feel out-of-band for the actual Quicksilver site.&lt;/p&gt;
&lt;p&gt;I won’t be embedding Disqus for comments, but if you want to chat I’m on the &lt;a href=&quot;https://bit.ly/rust-community&quot;&gt;Rust Community Discord&lt;/a&gt; as @ryanisaacg. I’d love to hear people’s thoughts on the new look, if Quicksilver should be moved to a sub-page of this site, and if State of Quicksilver should be a gist, blog posts here, or some combination.&lt;/p&gt;
</content>
    </entry>
  
  
    <entry>
      <title>The State of Quicksilver Feb 2019</title>
      <link href="https://ryanisaacg.com/posts/state-of-quicksilver-feb-2019.html"/>
      <updated>2019-02-04T00:00:00Z</updated>
      <id>https://ryanisaacg.com/posts/state-of-quicksilver-feb-2019.html</id>
      <content xml:lang="en" type="html">&lt;p&gt;For anyone who doesn’t know, &lt;a href=&quot;https://github.com/ryanisaacg/quicksilver&quot;&gt;Quicksilver&lt;/a&gt; is my 2D game framework that targets desktop and web. It is a pure-Rust library that focuses on ergonomics and simplicity.&lt;/p&gt;
&lt;p&gt;Quicksilver is part of a small (but growing) set of Rust game engines. Notable are the Amethyst project, an open-source game engine, and ggez, a LOVE-inspired 2D game framework.
Increasingly it is practical to build an entire game with only the Rust toolchain: winit provides windowing, a variety of crates allow access to platform graphics APIs, rodio provides sound, rusttype for font rendering, etc. A pure-Rust game framework is getting easier to make all the time.&lt;/p&gt;
&lt;p&gt;However, very few libraries support WASM out of the box. This means Quicksilver and Rust WASM games in general essentially have small implementations of windowing, event handling, sounds, graphics, and input for the web that have not been contributed upstream.&lt;/p&gt;
&lt;h2&gt;The Framework Problem&lt;/h2&gt;
&lt;p&gt;Opting to use Quicksilver for some feature (web support, API design, automatic batching) requires opting into &lt;em&gt;all&lt;/em&gt; of Quicksilver’s features. This isn’t necessarily great! Even with compile-time feature flags available, it’s hard to do any Quicksilver code without buying into the State trait. This boils down to the vision of Quicksilver as a framework: if you can just plug in Quicksilver and start making a game right away, it needs to be everything to everyone.&lt;/p&gt;
&lt;p&gt;Partly this is due to Quicksilver’s history as a bit of a learning project for me, which I wanted to build from scratch in as many places as possible. It’s also caused by my impatience: the Rust ecosystem is amazing and featureful, but waiting for every single upstream project to accept changes would mean that Quicksilver could only be developed as fast as its slowest dependency. I tend to have time to work on the project in bursts, when I clear out the bug backlog and implement a few features from the roadmap; this doesn’t mesh well with long-running interactions with other projects. The way I’ve handled this in the past is writing my own Javascript bindings for each feature, essentially cloning an entire crate.&lt;/p&gt;
&lt;h2&gt;The Fundamentals&lt;/h2&gt;
&lt;p&gt;Largely, Quicksilver’s API is approaching a state of stability. It accomplishes most of what I want it to, in a way I’m largely satisfied with. For end users, the Quicksilver project has been more or less stable for a few months, and no substantial breaking changes are planned for the future.&lt;/p&gt;
&lt;p&gt;However, Quicksilver still has quite a few systems implemented by a dependency and an ad-hoc web clone of that dependency. This is what I hope to change, by contributing web backends across the ecosystem. My ideal outcome is that the fundamental multimedia crates (winit, rodio, gilrs, etc.) can run on WASM out-of-the-box.&lt;/p&gt;
&lt;h2&gt;Going Forward&lt;/h2&gt;
&lt;p&gt;If it sounds like my current goal is to make Quicksilver obsolete, that wouldn’t be too far off. Quicksilver’s raison d’etre is packaging up a bundle of functionality and to provide a single API for both web and native. Moving the ecosystem to support web and native makes this less important. Parts of Quicksilver that I think are particularly useful will probably become their own crates (re-exported in Quicksilver) to allow their use outside the framework. Some future version of Quicksilver may just be entirely a re-export of various crates and types with a consistent organization.&lt;/p&gt;
&lt;p&gt;In essence, I want seamless desktop and WASM development to move from a selling point of developing games in Quicksilver to a selling point of developing games in Rust.&lt;/p&gt;
</content>
    </entry>
  
  
</feed>
